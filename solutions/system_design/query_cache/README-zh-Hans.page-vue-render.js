
    var pageVueRenderFn = function anonymous(
) {
with(this){return _c('div',{attrs:{"id":"app"}},[_c('header',{attrs:{"fixed":""}},[_c('navbar',{attrs:{"type":"dark"},scopedSlots:_u([{key:"brand",fn:function(){return [_c('a',{staticClass:"navbar-brand",attrs:{"href":"https://mazx4960.github.io/system-design-primer//index.html","title":"Home"}},[_v("System Design Primer")])]},proxy:true},{key:"right",fn:function(){return [_c('li',[_c('form',{staticClass:"navbar-form"},[_c('searchbar',{attrs:{"data":searchData,"placeholder":"Search","on-hit":searchCallback,"menu-align-right":""}})],1)])]},proxy:true}])},[_v(" "),_c('dropdown',{staticClass:"nav-link",scopedSlots:_u([{key:"header",fn:function(){return [_v("Solutions")]},proxy:true}])},[_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/mint/readme.html"}},[_v("mint")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/pastebin/readme.html"}},[_v("pastebin")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/query_cache/readme.html"}},[_v("query_cache")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/sales_rank/readme.html"}},[_v("sales_rank")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/scaling_aws/readme.html"}},[_v("scaling_aws")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/social_graph/readme.html"}},[_v("social_graph")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/twitter/readme.html"}},[_v("twitter")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/web_crawler/readme.html"}},[_v("web_crawler")])])])],1)],1),_v(" "),_c('div',{attrs:{"id":"flex-body"}},[_c('overlay-source',{staticClass:"fixed-header-padding",attrs:{"id":"site-nav","tag-name":"nav","to":"site-nav"}},[_c('div',{staticClass:"site-nav-top"},[_c('div',{staticClass:"font-weight-bold mb-2",staticStyle:{"font-size":"1.25rem"}},[_v("Topics")])]),_v(" "),_c('div',{staticClass:"nav-component slim-scroll"},[_c('site-nav',[_c('overlay-source',{staticClass:"site-nav-list site-nav-list-root",attrs:{"tag-name":"ul","to":"mb-site-nav"}},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_v("Preface\n\n"),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Motivation.html"}},[_v("Motivation")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Ankiflashcards.html"}},[_v("Anki flashcards")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Indexof-system-design-topics.html"}},[_v("Index")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Studyguide.html"}},[_v("Study Guide")])])])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_v("Interview Questions\n\n"),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Howto-approach-a-system-design-interview-question.html"}},[_v("How to approach a system design interview question")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Object-orienteddesign-interview-questions-with-solutions.html"}},[_v("OOP interview questions")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Systemdesign-interview-questions-with-solutions.html"}},[_v("System design interview questions")])])])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Systemdesign-topics-start-here.html"}},[_v("System design topics")]),_v(" "),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Performancevs-scalability.html"}},[_v("Performance vs scalability")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Latencyvs-throughput.html"}},[_v("Latency vs throughput")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Availabilityvs-consistency.html"}},[_v("Availability vs consistency")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Consistencypatterns.html"}},[_v("Consistency patterns")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Availabilitypatterns.html"}},[_v("Availability patterns")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Domainname-system.html"}},[_v("Domain name system")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Contentdelivery-network.html"}},[_v("Content delivery network")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Loadbalancer.html"}},[_v("Load balancer")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Reverseproxy-(web-server).html"}},[_v("Reverse proxy (web server)")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Applicationlayer.html"}},[_v("Application layer")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Database.html"}},[_v("Database")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Cache.html"}},[_v("Cache")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Asynchronism.html"}},[_v("Asynchronism")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Communication.html"}},[_v("Communication")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Security.html"}},[_v("Security")])])])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_v("Misc\n\n"),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Appendix.html"}},[_v("Appendix")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Underdevelopment.html"}},[_v("Under development")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Credits.html"}},[_v("Credits")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Contactinfo.html"}},[_v("Contact info")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Contributing.html"}},[_v("Contributing")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/License.html"}},[_v("License")])])])])])])],1)],1)]),_v(" "),_m(0),_v(" "),_c('overlay-source',{staticClass:"fixed-header-padding",attrs:{"id":"page-nav","tag-name":"nav","to":"page-nav"}},[_c('div',{staticClass:"nav-component slim-scroll"})])],1),_v(" "),_m(1)])}
};
    var pageVueStaticRenderFns = [function anonymous(
) {
with(this){return _c('div',{staticClass:"fixed-header-padding",attrs:{"id":"content-wrapper"}},[_c('h1',{attrs:{"id":"web"}},[_c('span',{staticClass:"anchor",attrs:{"id":"web"}}),_v("设计一个键-值缓存来存储最近 web 服务查询的结果"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#web","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_c('strong',[_v("注意：这个文档中的链接会直接指向"),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%BB%E9%A2%98%E7%9A%84%E7%B4%A2%E5%BC%95"}},[_v("系统设计主题索引")]),_v("中的有关部分，以避免重复的内容。你可以参考链接的相关内容，来了解其总的要点、方案的权衡取舍以及可选的替代方案。")])]),_v(" "),_c('h2',{attrs:{"id":""}},[_v("第一步：简述用例与约束条件")]),_v(" "),_c('blockquote',[_c('p',[_v("搜集需求与问题的范围。\n提出问题来明确用例与约束条件。\n讨论假设。")])]),_v(" "),_c('p',[_v("我们将在没有面试官明确说明问题的情况下，自己定义一些用例以及限制条件。")]),_v(" "),_c('h3',{attrs:{"id":"-2"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-2"}}),_v("用例"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-2","onclick":"event.stopPropagation()"}})]),_v(" "),_c('h4',{attrs:{"id":"-3"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-3"}}),_v("我们将把问题限定在仅处理以下用例的范围中"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-3","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('strong',[_v("用户")]),_v("发送一个搜索请求，命中缓存")]),_v(" "),_c('li',[_c('strong',[_v("用户")]),_v("发送一个搜索请求，未命中缓存")]),_v(" "),_c('li',[_c('strong',[_v("服务")]),_v("有着高可用性")])]),_v(" "),_c('h3',{attrs:{"id":"-4"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-4"}}),_v("限制条件与假设"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-4","onclick":"event.stopPropagation()"}})]),_v(" "),_c('h4',{attrs:{"id":"-5"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-5"}}),_v("提出假设"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-5","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("网络流量不是均匀分布的\n"),_c('ul',[_c('li',[_v("经常被查询的内容应该一直存于缓存中")]),_v(" "),_c('li',[_v("需要确定如何规定缓存过期、缓存刷新规则")])])]),_v(" "),_c('li',[_v("缓存提供的服务查询速度要快")]),_v(" "),_c('li',[_v("机器间延迟较低")]),_v(" "),_c('li',[_v("缓存有内存限制\n"),_c('ul',[_c('li',[_v("需要决定缓存什么、移除什么")]),_v(" "),_c('li',[_v("需要缓存百万级的查询")])])]),_v(" "),_c('li',[_v("1000 万用户")]),_v(" "),_c('li',[_v("每个月 100 亿次查询")])]),_v(" "),_c('h4',{attrs:{"id":"-6"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-6"}}),_v("计算用量"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-6","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_c('strong',[_v("如果你需要进行粗略的用量计算，请向你的面试官说明。")])]),_v(" "),_c('ul',[_c('li',[_v("缓存存储的是键值对有序表，键为 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("query")]),_v("（查询），值为 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("results")]),_v("（结果）。\n"),_c('ul',[_c('li',[_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("query")]),_v(" - 50 字节")]),_v(" "),_c('li',[_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("title")]),_v(" - 20 字节")]),_v(" "),_c('li',[_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("snippet")]),_v(" - 200 字节")]),_v(" "),_c('li',[_v("总计：270 字节")])])]),_v(" "),_c('li',[_v("假如 100 亿次查询都是不同的，且全部需要存储，那么每个月需要 2.7 TB 的缓存空间\n"),_c('ul',[_c('li',[_v("单次查询 270 字节 * 每月查询 100 亿次")]),_v(" "),_c('li',[_v("假设内存大小有限制，需要决定如何制定缓存过期规则")])])]),_v(" "),_c('li',[_v("每秒 4,000 次请求")])]),_v(" "),_c('p',[_v("便利换算指南：")]),_v(" "),_c('ul',[_c('li',[_v("每个月有 250 万秒")]),_v(" "),_c('li',[_v("每秒一个请求 = 每个月 250 万次请求")]),_v(" "),_c('li',[_v("每秒 40 个请求 = 每个月 1 亿次请求")]),_v(" "),_c('li',[_v("每秒 400 个请求 = 每个月 10 亿次请求")])]),_v(" "),_c('h2',{attrs:{"id":"-7"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-7"}}),_v("第二步：概要设计"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-7","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("列出所有重要组件以规划概要设计。")])]),_v(" "),_c('p',[_c('a',{attrs:{"href":"http://i.imgur.com/KqZ3dSx.png","target":"_self"}},[_c('img',{staticClass:"img-fluid",attrs:{"src":"http://i.imgur.com/KqZ3dSx.png","alt":""}})])]),_v(" "),_c('h2',{attrs:{"id":"-8"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-8"}}),_v("第三步：设计核心组件"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-8","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("深入每个核心组件的细节。")])]),_v(" "),_c('h3',{attrs:{"id":"-9"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-9"}}),_v("用例：用户发送了一次请求，命中了缓存"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-9","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("常用的查询可以由例如 Redis 或者 Memcached 之类的"),_c('strong',[_v("内存缓存")]),_v("提供支持，以减少数据读取延迟，并且避免"),_c('strong',[_v("反向索引服务")]),_v("以及"),_c('strong',[_v("文档服务")]),_v("的过载。从内存读取 1 MB 连续数据大约要花 250 微秒，而从 SSD 读取同样大小的数据要花费 4 倍的时间，从机械硬盘读取需要花费 80 倍以上的时间。"),_c('sup',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#每个程序员都应该知道的延迟数"}},[_v("1")])])]),_v(" "),_c('p',[_v("由于缓存容量有限，我们将使用 LRU（近期最少使用算法）来控制缓存的过期。")]),_v(" "),_c('ul',[_c('li',[_c('strong',[_v("客户端")]),_v("向运行"),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86web-%E6%9C%8D%E5%8A%A1%E5%99%A8"}},[_v("反向代理")]),_v("的 "),_c('strong',[_v("Web 服务器")]),_v("发送一个请求")]),_v(" "),_c('li',[_v("这个 "),_c('strong',[_v("Web 服务器")]),_v("将请求转发给"),_c('strong',[_v("查询 API")]),_v(" 服务")]),_v(" "),_c('li',[_c('strong',[_v("查询 API")]),_v(" 服务将会做这些事情：\n"),_c('ul',[_c('li',[_v("分析查询\n"),_c('ul',[_c('li',[_v("移除多余的内容")]),_v(" "),_c('li',[_v("将文本分割成词组")]),_v(" "),_c('li',[_v("修正拼写错误")]),_v(" "),_c('li',[_v("规范化字母的大小写")]),_v(" "),_c('li',[_v("将查询转换为布尔运算")])])]),_v(" "),_c('li',[_v("检测"),_c('strong',[_v("内存缓存")]),_v("是否有匹配查询的内容\n"),_c('ul',[_c('li',[_v("如果命中"),_c('strong',[_v("内存缓存")]),_v("，"),_c('strong',[_v("内存缓存")]),_v("将会做以下事情：\n"),_c('ul',[_c('li',[_v("将缓存入口的位置指向 LRU 链表的头部")]),_v(" "),_c('li',[_v("返回缓存内容")])])]),_v(" "),_c('li',[_v("否则，"),_c('strong',[_v("查询 API")]),_v(" 将会做以下事情：\n"),_c('ul',[_c('li',[_v("使用"),_c('strong',[_v("反向索引服务")]),_v("来查找匹配查询的文档\n"),_c('ul',[_c('li',[_c('strong',[_v("反向索引服务")]),_v("对匹配到的结果进行排名，然后返回最符合的结果")])])]),_v(" "),_c('li',[_v("使用"),_c('strong',[_v("文档服务")]),_v("返回文章标题与片段")]),_v(" "),_c('li',[_v("更新"),_c('strong',[_v("内存缓存")]),_v("，存入内容，将"),_c('strong',[_v("内存缓存")]),_v("入口位置指向 LRU 链表的头部")])])])])])])])]),_v(" "),_c('h4',{attrs:{"id":"-10"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-10"}}),_v("缓存的实现"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-10","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("缓存可以使用双向链表实现：新元素将会在头结点加入，过期的元素将会在尾节点被删除。我们使用哈希表以便能够快速查找每个链表节点。")]),_v(" "),_c('p',[_c('strong',[_v("向你的面试官告知你准备写多少代码")]),_v("。")]),_v(" "),_c('p',[_v("实现"),_c('strong',[_v("查询 API 服务")]),_v("：")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("QueryApi")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, memory_cache, reverse_index_service")]),_v("):")]),_v("\n")]),_c('span',[_v("        self.memory_cache = memory_cache\n")]),_c('span',[_v("        self.reverse_index_service = reverse_index_service\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("parse_query")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, query")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-string"}},[_v("\"\"\"移除多余内容，将文本分割成词组，修复拼写错误，")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-string"}},[_v("        规范化字母大小写，转换布尔运算。")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-string"}},[_v("        \"\"\"")]),_v("\n")]),_c('span',[_v("        ...\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("process_query")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, query")]),_v("):")]),_v("\n")]),_c('span',[_v("        query = self.parse_query(query)\n")]),_c('span',[_v("        results = self.memory_cache.get(query)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" results "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("            results = self.reverse_index_service.process_search(query)\n")]),_c('span',[_v("            self.memory_cache."),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("set")]),_v("(query, results)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" results\n")])])]),_c('p',[_v("实现"),_c('strong',[_v("节点")]),_v("：")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("Node")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, query, results")]),_v("):")]),_v("\n")]),_c('span',[_v("        self.query = query\n")]),_c('span',[_v("        self.results = results\n")])])]),_c('p',[_v("实现"),_c('strong',[_v("链表")]),_v("：")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("LinkedList")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self")]),_v("):")]),_v("\n")]),_c('span',[_v("        self.head = "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")]),_c('span',[_v("        self.tail = "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("move_to_front")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, node")]),_v("):")]),_v("\n")]),_c('span',[_v("        ...\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("append_to_front")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, node")]),_v("):")]),_v("\n")]),_c('span',[_v("        ...\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("remove_from_tail")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self")]),_v("):")]),_v("\n")]),_c('span',[_v("        ...\n")])])]),_c('p',[_v("实现"),_c('strong',[_v("缓存")]),_v("：")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("Cache")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, MAX_SIZE")]),_v("):")]),_v("\n")]),_c('span',[_v("        self.MAX_SIZE = MAX_SIZE\n")]),_c('span',[_v("        self.size = "),_c('span',{pre:true,attrs:{"class":"hljs-number"}},[_v("0")]),_v("\n")]),_c('span',[_v("        self.lookup = {}  "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# key: query, value: node")]),_v("\n")]),_c('span',[_v("        self.linked_list = LinkedList()\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("get")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, query")]),_v(")")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_v("        \"\"\"从缓存取得存储的内容")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-function"}}),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_v("        将入口节点位置更新为 "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("LRU")]),_v(" 链表的头部。")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_v("        \"\"\"")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("node")]),_v(" = "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("self")]),_v("."),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("lookup")]),_v("["),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("query")]),_v("]")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("if")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("node")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("None")]),_v(":")]),_v("\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")]),_c('span',[_v("        self.linked_list.move_to_front(node)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" node.results\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("set")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, results, query")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-string"}},[_v("\"\"\"将所给查询键的结果存在缓存中。")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-string"}}),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-string"}},[_v("        当更新缓存记录的时候，将它的位置指向 LRU 链表的头部。")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-string"}},[_v("        如果这个记录是新的记录，并且缓存空间已满，应该在加入新记录前")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-string"}},[_v("        删除最老的记录。")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-string"}},[_v("        \"\"\"")]),_v("\n")]),_c('span',[_v("        node = self.lookup[query]\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" node "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("not")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# 键存在于缓存中，更新它对应的值")]),_v("\n")]),_c('span',[_v("            node.results = results\n")]),_c('span',[_v("            self.linked_list.move_to_front(node)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("else")]),_v(":\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# 键不存在于缓存中")]),_v("\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" self.size == self.MAX_SIZE:\n")]),_c('span',[_v("                "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# 在链表中查找并删除最老的记录")]),_v("\n")]),_c('span',[_v("                self.lookup.pop(self.linked_list.tail.query, "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(")\n")]),_c('span',[_v("                self.linked_list.remove_from_tail()\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("else")]),_v(":\n")]),_c('span',[_v("                self.size += "),_c('span',{pre:true,attrs:{"class":"hljs-number"}},[_v("1")]),_v("\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# 添加新的键值对")]),_v("\n")]),_c('span',[_v("            new_node = Node(query, results)\n")]),_c('span',[_v("            self.linked_list.append_to_front(new_node)\n")]),_c('span',[_v("            self.lookup[query] = new_node\n")])])]),_c('h4',{attrs:{"id":"-11"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-11"}}),_v("何时更新缓存"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-11","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("缓存将会在以下几种情况更新：")]),_v(" "),_c('ul',[_c('li',[_v("页面内容发生变化")]),_v(" "),_c('li',[_v("页面被移除或者加入了新页面")]),_v(" "),_c('li',[_v("页面的权值发生变动")])]),_v(" "),_c('p',[_v("解决这些问题的最直接的方法，就是为缓存记录设置一个它在被更新前能留在缓存中的最长时间，这个时间简称为存活时间（TTL）。")]),_v(" "),_c('p',[_v("参考 "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E4%BD%95%E6%97%B6%E6%9B%B4%E6%96%B0%E7%BC%93%E5%AD%98"}},[_v("「何时更新缓存」")]),_v("来了解其权衡取舍及替代方案。以上方法在"),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%BC%93%E5%AD%98%E6%A8%A1%E5%BC%8F"}},[_v("缓存模式")]),_v("一章中详细地进行了描述。")]),_v(" "),_c('h2',{attrs:{"id":"-12"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-12"}}),_v("第四步：架构扩展"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-12","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("根据限制条件，找到并解决瓶颈。")])]),_v(" "),_c('p',[_c('a',{attrs:{"href":"http://i.imgur.com/4j99mhe.png","target":"_self"}},[_c('img',{staticClass:"img-fluid",attrs:{"src":"http://i.imgur.com/4j99mhe.png","alt":""}})])]),_v(" "),_c('p',[_c('strong',[_v("重要提示：不要从最初设计直接跳到最终设计中！")])]),_v(" "),_c('p',[_v("现在你要 1) "),_c('strong',[_v("基准测试、负载测试")]),_v("。2) "),_c('strong',[_v("分析、描述")]),_v("性能瓶颈。3) 在解决瓶颈问题的同时，评估替代方案、权衡利弊。4) 重复以上步骤。请阅读"),_c('a',{attrs:{"href":"/mazx4960.github.io/system-design-primer/solutions/system_design/scaling_aws/README.html"}},[_v("「设计一个系统，并将其扩大到为数以百万计的 AWS 用户服务」")]),_v(" 来了解如何逐步扩大初始设计。")]),_v(" "),_c('p',[_v("讨论初始设计可能遇到的瓶颈及相关解决方案是很重要的。例如加上一个配置多台 "),_c('strong',[_v("Web 服务器")]),_v("的"),_c('strong',[_v("负载均衡器")]),_v("是否能够解决问题？"),_c('strong',[_v("CDN")]),_v("呢？"),_c('strong',[_v("主从复制")]),_v("呢？它们各自的替代方案和需要"),_c('strong',[_v("权衡")]),_v("的利弊又有什么呢？")]),_v(" "),_c('p',[_v("我们将会介绍一些组件来完成设计，并解决架构扩张问题。内置的负载均衡器将不做讨论以节省篇幅。")]),_v(" "),_c('p',[_c('strong',[_v("为了避免重复讨论")]),_v("，请参考"),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%BB%E9%A2%98%E7%9A%84%E7%B4%A2%E5%BC%95"}},[_v("系统设计主题索引")]),_v("相关部分来了解其要点、方案的权衡取舍以及可选的替代方案。")]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F"}},[_v("DNS")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8"}},[_v("负载均衡器")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%B0%B4%E5%B9%B3%E6%89%A9%E5%B1%95"}},[_v("水平拓展")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86web-%E6%9C%8D%E5%8A%A1%E5%99%A8"}},[_v("反向代理（web 服务器）")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%BA%94%E7%94%A8%E5%B1%82"}},[_v("API 服务（应用层）")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%BC%93%E5%AD%98"}},[_v("缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E4%B8%80%E8%87%B4%E6%80%A7%E6%A8%A1%E5%BC%8F"}},[_v("一致性模式")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%8F%AF%E7%94%A8%E6%80%A7%E6%A8%A1%E5%BC%8F"}},[_v("可用性模式")])])]),_v(" "),_c('h3',{attrs:{"id":"-13"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-13"}}),_v("将内存缓存扩大到多台机器"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-13","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("为了解决庞大的请求负载以及巨大的内存需求，我们将要对架构进行水平拓展。如何在我们的"),_c('strong',[_v("内存缓存")]),_v("集群中存储数据呢？我们有以下三个主要可选方案：")]),_v(" "),_c('ul',[_c('li',[_c('strong',[_v("缓存集群中的每一台机器都有自己的缓存")]),_v(" - 简单，但是它会降低缓存命中率。")]),_v(" "),_c('li',[_c('strong',[_v("缓存集群中的每一台机器都有缓存的拷贝")]),_v(" - 简单，但是它的内存使用效率太低了。")]),_v(" "),_c('li',[_c('strong',[_v("对缓存进行"),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%88%86%E7%89%87"}},[_v("分片")]),_v("，分别部署在缓存集群中的所有机器中")]),_v(" - 更加复杂，但是它是最佳的选择。我们可以使用哈希，用查询语句 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("machine = hash(query)")]),_v(" 来确定哪台机器有需要缓存。当然我们也可以使用"),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%AD%A3%E5%9C%A8%E5%AE%8C%E5%96%84%E4%B8%AD"}},[_v("一致性哈希")]),_v("。")])]),_v(" "),_c('h2',{attrs:{"id":"-14"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-14"}}),_v("其它要点"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-14","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("是否深入这些额外的主题，取决于你的问题范围和剩下的时间。")])]),_v(" "),_c('h3',{attrs:{"id":"sql"}},[_c('span',{staticClass:"anchor",attrs:{"id":"sql"}}),_v("SQL 缩放模式"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#sql","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"}},[_v("读取复制")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%81%94%E5%90%88"}},[_v("联合")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%88%86%E7%89%87"}},[_v("分片")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E9%9D%9E%E8%A7%84%E8%8C%83%E5%8C%96"}},[_v("非规范化")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#sql-%E8%B0%83%E4%BC%98"}},[_v("SQL 调优")])])]),_v(" "),_c('h4',{attrs:{"id":"nosql"}},[_c('span',{staticClass:"anchor",attrs:{"id":"nosql"}}),_v("NoSQL"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#nosql","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E9%94%AE-%E5%80%BC%E5%AD%98%E5%82%A8"}},[_v("键-值存储")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%96%87%E6%A1%A3%E7%B1%BB%E5%9E%8B%E5%AD%98%E5%82%A8"}},[_v("文档类型存储")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%88%97%E5%9E%8B%E5%AD%98%E5%82%A8"}},[_v("列型存储")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93"}},[_v("图数据库")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#sql-%E8%BF%98%E6%98%AF-nosql"}},[_v("SQL vs NoSQL")])])]),_v(" "),_c('h3',{attrs:{"id":"-15"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-15"}}),_v("缓存"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-15","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("在哪缓存\n"),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%93%E5%AD%98"}},[_v("客户端缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#cdn-%E7%BC%93%E5%AD%98"}},[_v("CDN 缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#web-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%93%E5%AD%98"}},[_v("Web 服务器缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%93%E5%AD%98"}},[_v("数据库缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%BA%94%E7%94%A8%E7%BC%93%E5%AD%98"}},[_v("应用缓存")])])])]),_v(" "),_c('li',[_v("什么需要缓存\n"),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2%E7%BA%A7%E5%88%AB%E7%9A%84%E7%BC%93%E5%AD%98"}},[_v("数据库查询级别的缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%AF%B9%E8%B1%A1%E7%BA%A7%E5%88%AB%E7%9A%84%E7%BC%93%E5%AD%98"}},[_v("对象级别的缓存")])])])]),_v(" "),_c('li',[_v("何时更新缓存\n"),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%BC%93%E5%AD%98%E6%A8%A1%E5%BC%8F"}},[_v("缓存模式")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%9B%B4%E5%86%99%E6%A8%A1%E5%BC%8F"}},[_v("直写模式")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%9B%9E%E5%86%99%E6%A8%A1%E5%BC%8F"}},[_v("回写模式")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%88%B7%E6%96%B0"}},[_v("刷新")])])])])]),_v(" "),_c('h3',{attrs:{"id":"-16"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-16"}}),_v("异步与微服务"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-16","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"}},[_v("消息队列")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97"}},[_v("任务队列")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%83%8C%E5%8E%8B"}},[_v("背压")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%BE%AE%E6%9C%8D%E5%8A%A1"}},[_v("微服务")])])]),_v(" "),_c('h3',{attrs:{"id":"-17"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-17"}}),_v("通信"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-17","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("可权衡选择的方案：\n"),_c('ul',[_c('li',[_v("与客户端的外部通信 - "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%A1%A8%E8%BF%B0%E6%80%A7%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BBrest"}},[_v("使用 REST 作为 HTTP API")])]),_v(" "),_c('li',[_v("服务器内部通信 - "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%BF%9C%E7%A8%8B%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8%E5%8D%8F%E8%AE%AErpc"}},[_v("RPC")])])])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0"}},[_v("服务发现")])])]),_v(" "),_c('h3',{attrs:{"id":"-18"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-18"}}),_v("安全性"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-18","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("请参阅"),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%AE%89%E5%85%A8"}},[_v("「安全」")]),_v("一章。")]),_v(" "),_c('h3',{attrs:{"id":"-19"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-19"}}),_v("延迟数值"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-19","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("请参阅"),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%AF%8F%E4%B8%AA%E7%A8%8B%E5%BA%8F%E5%91%98%E9%83%BD%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84%E5%BB%B6%E8%BF%9F%E6%95%B0"}},[_v("「每个程序员都应该知道的延迟数」")]),_v("。")]),_v(" "),_c('h3',{attrs:{"id":"-20"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-20"}}),_v("持续探讨"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-20","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("持续进行基准测试并监控你的系统，以解决他们提出的瓶颈问题。")]),_v(" "),_c('li',[_v("架构拓展是一个迭代的过程。")])]),_v(" "),_c('i',{staticClass:"fa fa-arrow-circle-up fa-lg d-print-none",attrs:{"id":"scroll-top-button","onclick":"handleScrollTop()","aria-hidden":"true"}})])}
},function anonymous(
) {
with(this){return _c('footer',[_c('div',{staticClass:"text-center"},[_c('small',[_v("[Generated by "),_c('a',{attrs:{"href":"https://markbind.org/"}},[_v("MarkBind 3.1.1")]),_v("]")])])])}
}];
  