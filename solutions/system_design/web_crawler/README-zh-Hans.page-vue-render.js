
    var pageVueRenderFn = function anonymous(
) {
with(this){return _c('div',{attrs:{"id":"app"}},[_c('header',{attrs:{"fixed":""}},[_c('navbar',{attrs:{"type":"dark"},scopedSlots:_u([{key:"brand",fn:function(){return [_c('a',{staticClass:"navbar-brand",attrs:{"href":"https://mazx4960.github.io/system-design-primer//index.html","title":"Home"}},[_v("System Design Primer")])]},proxy:true},{key:"right",fn:function(){return [_c('li',[_c('form',{staticClass:"navbar-form"},[_c('searchbar',{attrs:{"data":searchData,"placeholder":"Search","on-hit":searchCallback,"menu-align-right":""}})],1)])]},proxy:true}])},[_v(" "),_c('dropdown',{staticClass:"nav-link",scopedSlots:_u([{key:"header",fn:function(){return [_v("Solutions")]},proxy:true}])},[_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/mint/README.html"}},[_v("mint")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/pastebin/README.html"}},[_v("pastebin")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/query_cache/README.html"}},[_v("query_cache")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/sales_rank/README.html"}},[_v("sales_rank")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/scaling_aws/README.html"}},[_v("scaling_aws")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/social_graph/README.html"}},[_v("social_graph")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/twitter/README.html"}},[_v("twitter")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"https://mazx4960.github.io/system-design-primer//solutions/system_design/web_crawler/README.html"}},[_v("web_crawler")])])])],1)],1),_v(" "),_c('div',{attrs:{"id":"flex-body"}},[_c('overlay-source',{staticClass:"fixed-header-padding",attrs:{"id":"site-nav","tag-name":"nav","to":"site-nav"}},[_c('div',{staticClass:"site-nav-top"},[_c('div',{staticClass:"font-weight-bold mb-2",staticStyle:{"font-size":"1.25rem"}},[_v("Topics")])]),_v(" "),_c('div',{staticClass:"nav-component slim-scroll"},[_c('site-nav',[_c('overlay-source',{staticClass:"site-nav-list site-nav-list-root",attrs:{"tag-name":"ul","to":"mb-site-nav"}},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_v("Preface\n\n"),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Motivation.html"}},[_v("Motivation")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Ankiflashcards.html"}},[_v("Anki flashcards")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Indexof-system-design-topics.html"}},[_v("Index")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Studyguide.html"}},[_v("Study Guide")])])])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_v("Interview Questions\n\n"),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Howto-approach-a-system-design-interview-question.html"}},[_v("How to approach a system design interview question")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Object-orienteddesign-interview-questions-with-solutions.html"}},[_v("OOP interview questions")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Systemdesign-interview-questions-with-solutions.html"}},[_v("System design interview questions")])])])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Systemdesign-topics-start-here.html"}},[_v("System design topics")]),_v(" "),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Performancevs-scalability.html"}},[_v("Performance vs scalability")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Latencyvs-throughput.html"}},[_v("Latency vs throughput")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Availabilityvs-consistency.html"}},[_v("Availability vs consistency")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Consistencypatterns.html"}},[_v("Consistency patterns")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Availabilitypatterns.html"}},[_v("Availability patterns")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Domainname-system.html"}},[_v("Domain name system")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Contentdelivery-network.html"}},[_v("Content delivery network")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Loadbalancer.html"}},[_v("Load balancer")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Reverseproxy-(web-server).html"}},[_v("Reverse proxy (web server)")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Applicationlayer.html"}},[_v("Application layer")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Database.html"}},[_v("Database")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Cache.html"}},[_v("Cache")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Asynchronism.html"}},[_v("Asynchronism")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Communication.html"}},[_v("Communication")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Security.html"}},[_v("Security")])])])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_v("Misc\n\n"),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Appendix.html"}},[_v("Appendix")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Underdevelopment.html"}},[_v("Under development")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Credits.html"}},[_v("Credits")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Contactinfo.html"}},[_v("Contact info")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/Contributing.html"}},[_v("Contributing")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"https://mazx4960.github.io/system-design-primer//contents/License.html"}},[_v("License")])])])])])])],1)],1)]),_v(" "),_m(0),_v(" "),_c('overlay-source',{staticClass:"fixed-header-padding",attrs:{"id":"page-nav","tag-name":"nav","to":"page-nav"}},[_c('div',{staticClass:"nav-component slim-scroll"})])],1),_v(" "),_m(1)])}
};
    var pageVueStaticRenderFns = [function anonymous(
) {
with(this){return _c('div',{staticClass:"fixed-header-padding",attrs:{"id":"content-wrapper"}},[_c('h1',{attrs:{"id":""}},[_v("设计一个网页爬虫")]),_v(" "),_c('p',[_c('strong',[_v("注意：这个文档中的链接会直接指向"),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%BB%E9%A2%98%E7%9A%84%E7%B4%A2%E5%BC%95"}},[_v("系统设计主题索引")]),_v("中的有关部分，以避免重复的内容。你可以参考链接的相关内容，来了解其总的要点、方案的权衡取舍以及可选的替代方案。")])]),_v(" "),_c('h2',{attrs:{"id":"-2"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-2"}}),_v("第一步：简述用例与约束条件"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-2","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("把所有需要的东西聚集在一起，审视问题。不停的提问，以至于我们可以明确使用场景和约束。讨论假设。")])]),_v(" "),_c('p',[_v("我们将在没有面试官明确说明问题的情况下，自己定义一些用例以及限制条件。")]),_v(" "),_c('h3',{attrs:{"id":"-3"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-3"}}),_v("用例"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-3","onclick":"event.stopPropagation()"}})]),_v(" "),_c('h4',{attrs:{"id":"-4"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-4"}}),_v("我们把问题限定在仅处理以下用例的范围中"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-4","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('strong',[_v("服务")]),_v(" 抓取一系列链接：\n"),_c('ul',[_c('li',[_v("生成包含搜索词的网页倒排索引")]),_v(" "),_c('li',[_v("生成页面的标题和摘要信息\n"),_c('ul',[_c('li',[_v("页面标题和摘要都是静态的，它们不会根据搜索词改变")])])])])]),_v(" "),_c('li',[_c('strong',[_v("用户")]),_v(" 输入搜索词后，可以看到相关的搜索结果列表，列表每一项都包含由网页爬虫生成的页面标题及摘要\n"),_c('ul',[_c('li',[_v("只给该用例绘制出概要组件和交互说明，无需讨论细节")])])]),_v(" "),_c('li',[_c('strong',[_v("服务")]),_v(" 具有高可用性")])]),_v(" "),_c('h4',{attrs:{"id":"-5"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-5"}}),_v("无需考虑"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-5","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("搜索分析")]),_v(" "),_c('li',[_v("个性化搜索结果")]),_v(" "),_c('li',[_v("页面排名")])]),_v(" "),_c('h3',{attrs:{"id":"-6"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-6"}}),_v("限制条件与假设"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-6","onclick":"event.stopPropagation()"}})]),_v(" "),_c('h4',{attrs:{"id":"-7"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-7"}}),_v("提出假设"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-7","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("搜索流量分布不均\n"),_c('ul',[_c('li',[_v("有些搜索词非常热门，有些则非常冷门")])])]),_v(" "),_c('li',[_v("只支持匿名用户")]),_v(" "),_c('li',[_v("用户很快就能看到搜索结果")]),_v(" "),_c('li',[_v("网页爬虫不应该陷入死循环\n"),_c('ul',[_c('li',[_v("当爬虫路径包含环的时候，将会陷入死循环")])])]),_v(" "),_c('li',[_v("抓取 10 亿个链接\n"),_c('ul',[_c('li',[_v("要定期重新抓取页面以确保新鲜度")]),_v(" "),_c('li',[_v("平均每周重新抓取一次，网站越热门，那么重新抓取的频率越高\n"),_c('ul',[_c('li',[_v("每月抓取 40 亿个链接")])])]),_v(" "),_c('li',[_v("每个页面的平均存储大小：500 KB\n"),_c('ul',[_c('li',[_v("简单起见，重新抓取的页面算作新页面")])])])])]),_v(" "),_c('li',[_v("每月搜索量 1000 亿次")])]),_v(" "),_c('p',[_v("用更传统的系统来练习 —— 不要使用 "),_c('a',{attrs:{"href":"http://lucene.apache.org/solr/"}},[_v("solr")]),_v(" 、"),_c('a',{attrs:{"href":"http://nutch.apache.org/"}},[_v("nutch")]),_v(" 之类的现成系统。")]),_v(" "),_c('h4',{attrs:{"id":"-8"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-8"}}),_v("计算用量"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-8","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_c('strong',[_v("如果你需要进行粗略的用量计算，请向你的面试官说明。")])]),_v(" "),_c('ul',[_c('li',[_v("每月存储 2 PB 页面\n"),_c('ul',[_c('li',[_v("每月抓取 40 亿个页面，每个页面 500 KB")]),_v(" "),_c('li',[_v("三年存储 72 PB 页面")])])]),_v(" "),_c('li',[_v("每秒 1600 次写请求")]),_v(" "),_c('li',[_v("每秒 40000 次搜索请求")])]),_v(" "),_c('p',[_v("简便换算指南：")]),_v(" "),_c('ul',[_c('li',[_v("一个月有 250 万秒")]),_v(" "),_c('li',[_v("每秒 1 个请求，即每月 250 万个请求")]),_v(" "),_c('li',[_v("每秒 40 个请求，即每月 1 亿个请求")]),_v(" "),_c('li',[_v("每秒 400 个请求，即每月 10 亿个请求")])]),_v(" "),_c('h2',{attrs:{"id":"-9"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-9"}}),_v("第二步： 概要设计"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-9","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("列出所有重要组件以规划概要设计。")])]),_v(" "),_c('p',[_c('a',{attrs:{"href":"http://i.imgur.com/xjdAAUv.png","target":"_self"}},[_c('img',{staticClass:"img-fluid",attrs:{"src":"http://i.imgur.com/xjdAAUv.png","alt":""}})])]),_v(" "),_c('h2',{attrs:{"id":"-10"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-10"}}),_v("第三步：设计核心组件"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-10","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("对每一个核心组件进行详细深入的分析。")])]),_v(" "),_c('h3',{attrs:{"id":"-11"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-11"}}),_v("用例：爬虫服务抓取一系列网页"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-11","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("假设我们有一个初始列表 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("links_to_crawl")]),_v("（待抓取链接），它最初基于网站整体的知名度来排序。当然如果这个假设不合理，我们可以使用 "),_c('a',{attrs:{"href":"https://www.yahoo.com/"}},[_v("Yahoo")]),_v("、"),_c('a',{attrs:{"href":"http://www.dmoz.org/"}},[_v("DMOZ")]),_v(" 等知名门户网站作为种子链接来进行扩散 。")]),_v(" "),_c('p',[_v("我们将用表 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("crawled_links")]),_v(" （已抓取链接 ）来记录已经处理过的链接以及相应的页面签名。")]),_v(" "),_c('p',[_v("我们可以将 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("links_to_crawl")]),_v(" 和 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("crawled_links")]),_v(" 记录在键-值型 "),_c('strong',[_v("NoSQL 数据库")]),_v("中。对于 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("crawled_links")]),_v(" 中已排序的链接，我们可以使用 "),_c('a',{attrs:{"href":"https://redis.io/"}},[_v("Redis")]),_v(" 的有序集合来维护网页链接的排名。我们应当在 "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#sql-%E8%BF%98%E6%98%AF-nosql"}},[_v("选择 SQL 还是 NoSQL 的问题上，讨论有关使用场景以及利弊 ")]),_v("。")]),_v(" "),_c('ul',[_c('li',[_c('strong',[_v("爬虫服务")]),_v("按照以下流程循环处理每一个页面链接：\n"),_c('ul',[_c('li',[_v("选取排名最靠前的待抓取链接\n"),_c('ul',[_c('li',[_v("在  "),_c('strong',[_v("NoSQL 数据库")]),_v("的 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("crawled_links")]),_v(" 中，检查待抓取页面的签名是否与某个已抓取页面的签名相似\n"),_c('ul',[_c('li',[_v("若存在，则降低该页面链接的优先级\n"),_c('ul',[_c('li',[_v("这样做可以避免陷入死循环")]),_v(" "),_c('li',[_v("继续（进入下一次循环）")])])]),_v(" "),_c('li',[_v("若不存在，则抓取该链接\n"),_c('ul',[_c('li',[_v("在"),_c('strong',[_v("倒排索引服务")]),_v("任务队列中，新增一个生成"),_c('a',{attrs:{"href":"https://en.wikipedia.org/wiki/Search_engine_indexing"}},[_v("倒排索引")]),_v("任务。")]),_v(" "),_c('li',[_v("在"),_c('strong',[_v("文档服务")]),_v("任务队列中，新增一个生成静态标题和摘要的任务。")]),_v(" "),_c('li',[_v("生成页面签名")]),_v(" "),_c('li',[_v("在 "),_c('strong',[_v("NoSQL 数据库")]),_v("的 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("links_to_crawl")]),_v(" 中删除该链接")]),_v(" "),_c('li',[_v("在 "),_c('strong',[_v("NoSQL 数据库")]),_v("的 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("crawled_links")]),_v(" 中插入该链接以及页面签名")])])])])])])])])])]),_v(" "),_c('p',[_c('strong',[_v("向面试官了解你需要写多少代码")]),_v("。")]),_v(" "),_c('p',[_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("PagesDataStore")]),_v(" 是"),_c('strong',[_v("爬虫服务")]),_v("中的一个抽象类，它使用 "),_c('strong',[_v("NoSQL 数据库")]),_v("进行存储。")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("PagesDataStore")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, db")]),_v(");")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("self")]),_v("."),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("db")]),_v(" = "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("db")])]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_v("        ...")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-function"}}),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("add_link_to_crawl")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, url")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-string"}},[_v("\"\"\"将指定链接加入 `links_to_crawl`。\"\"\"")]),_v("\n")]),_c('span',[_v("        ...\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("remove_link_to_crawl")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, url")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-string"}},[_v("\"\"\"从 `links_to_crawl` 中删除指定链接。\"\"\"")]),_v("\n")]),_c('span',[_v("        ...\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("reduce_priority_link_to_crawl")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, url")]),_v(")")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_v("        \"\"\"在 `"),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("links_to_crawl")]),_v("` 中降低一个链接的优先级以避免死循环。\"\"\"")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_v("        ...")]),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-function"}}),_v("\n")]),_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("extract_max_priority_page")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-string"}},[_v("\"\"\"返回 `links_to_crawl` 中优先级最高的链接。\"\"\"")]),_v("\n")]),_c('span',[_v("        ...\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("insert_crawled_link")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, url, signature")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-string"}},[_v("\"\"\"将指定链接加入 `crawled_links`。\"\"\"")]),_v("\n")]),_c('span',[_v("        ...\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("crawled_similar")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, signature")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-string"}},[_v("\"\"\"判断待抓取页面的签名是否与某个已抓取页面的签名相似。\"\"\"")]),_v("\n")]),_c('span',[_v("        ...\n")])])]),_c('p',[_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("Page")]),_v(" 是"),_c('strong',[_v("爬虫服务")]),_v("的一个抽象类，它封装了网页对象，由页面链接、页面内容、子链接和页面签名构成。")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("Page")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, url, contents, child_urls, signature")]),_v("):")]),_v("\n")]),_c('span',[_v("        self.url = url\n")]),_c('span',[_v("        self.contents = contents\n")]),_c('span',[_v("        self.child_urls = child_urls\n")]),_c('span',[_v("        self.signature = signature\n")])])]),_c('p',[_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("Crawler")]),_v(" 是"),_c('strong',[_v("爬虫服务")]),_v("的主类，由"),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("Page")]),_v(" 和 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("PagesDataStore")]),_v(" 组成。")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("Crawler")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, data_store, reverse_index_queue, doc_index_queue")]),_v("):")]),_v("\n")]),_c('span',[_v("        self.data_store = data_store\n")]),_c('span',[_v("        self.reverse_index_queue = reverse_index_queue\n")]),_c('span',[_v("        self.doc_index_queue = doc_index_queue\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("create_signature")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, page")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-string"}},[_v("\"\"\"基于页面链接与内容生成签名。\"\"\"")]),_v("\n")]),_c('span',[_v("        ...\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("crawl_page")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, page")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("for")]),_v(" url "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("in")]),_v(" page.child_urls:\n")]),_c('span',[_v("            self.data_store.add_link_to_crawl(url)\n")]),_c('span',[_v("        page.signature = self.create_signature(page)\n")]),_c('span',[_v("        self.data_store.remove_link_to_crawl(page.url)\n")]),_c('span',[_v("        self.data_store.insert_crawled_link(page.url, page.signature)\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("crawl")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("while")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("True")]),_v(":\n")]),_c('span',[_v("            page = self.data_store.extract_max_priority_page()\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" page "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("                "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("break")]),_v("\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" self.data_store.crawled_similar(page.signature):\n")]),_c('span',[_v("                self.data_store.reduce_priority_link_to_crawl(page.url)\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("else")]),_v(":\n")]),_c('span',[_v("                self.crawl_page(page)\n")])])]),_c('h3',{attrs:{"id":"-12"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-12"}}),_v("处理重复内容"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-12","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("我们要谨防网页爬虫陷入死循环，这通常会发生在爬虫路径中存在环的情况。")]),_v(" "),_c('p',[_c('strong',[_v("向面试官了解你需要写多少代码")]),_v(".")]),_v(" "),_c('p',[_v("删除重复链接：")]),_v(" "),_c('ul',[_c('li',[_v("假设数据量较小，我们可以用类似于 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("sort | unique")]),_v(" 的方法。（译注： 先排序，后去重）")]),_v(" "),_c('li',[_v("假设有 10 亿条数据，我们应该使用 "),_c('strong',[_v("MapReduce")]),_v(" 来输出只出现 1 次的记录。")])]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("RemoveDuplicateUrls")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("MRJob")]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("mapper")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, _, line")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("yield")]),_v(" line, "),_c('span',{pre:true,attrs:{"class":"hljs-number"}},[_v("1")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("reducer")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, key, values")]),_v("):")]),_v("\n")]),_c('span',[_v("        total = "),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("sum")]),_v("(values)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" total == "),_c('span',{pre:true,attrs:{"class":"hljs-number"}},[_v("1")]),_v(":\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("yield")]),_v(" key, total\n")])])]),_c('p',[_v("比起处理重复内容，检测重复内容更为复杂。我们可以基于网页内容生成签名，然后对比两者签名的相似度。可能会用到的算法有 "),_c('a',{attrs:{"href":"https://en.wikipedia.org/wiki/Jaccard_index"}},[_v("Jaccard index")]),_v(" 以及 "),_c('a',{attrs:{"href":"https://en.wikipedia.org/wiki/Cosine_similarity"}},[_v("cosine similarity")]),_v("。")]),_v(" "),_c('h3',{attrs:{"id":"-13"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-13"}}),_v("抓取结果更新策略"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-13","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("要定期重新抓取页面以确保新鲜度。抓取结果应该有个 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("timestamp")]),_v(" 字段记录上一次页面抓取时间。每隔一段时间，比如说 1 周，所有页面都需要更新一次。对于热门网站或是内容频繁更新的网站，爬虫抓取间隔可以缩短。")]),_v(" "),_c('p',[_v("尽管我们不会深入网页数据分析的细节，我们仍然要做一些数据挖掘工作来确定一个页面的平均更新时间，并且根据相关的统计数据来决定爬虫的重新抓取频率。")]),_v(" "),_c('p',[_v("当然我们也应该根据站长提供的 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("Robots.txt")]),_v(" 来控制爬虫的抓取频率。")]),_v(" "),_c('h3',{attrs:{"id":"-14"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-14"}}),_v("用例：用户输入搜索词后，可以看到相关的搜索结果列表，列表每一项都包含由网页爬虫生成的页面标题及摘要"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-14","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('strong',[_v("客户端")]),_v("向运行"),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86web-%E6%9C%8D%E5%8A%A1%E5%99%A8"}},[_v("反向代理")]),_v("的 "),_c('strong',[_v("Web 服务器")]),_v("发送一个请求")]),_v(" "),_c('li',[_c('strong',[_v("Web 服务器")]),_v(" 发送请求到 "),_c('strong',[_v("Query API")]),_v(" 服务器")]),_v(" "),_c('li',[_c('strong',[_v("查询 API")]),_v(" 服务将会做这些事情：\n"),_c('ul',[_c('li',[_v("解析查询参数\n"),_c('ul',[_c('li',[_v("删除 HTML 标记")]),_v(" "),_c('li',[_v("将文本分割成词组 （译注： 分词处理）")]),_v(" "),_c('li',[_v("修正错别字")]),_v(" "),_c('li',[_v("规范化大小写")]),_v(" "),_c('li',[_v("将搜索词转换为布尔运算")])])]),_v(" "),_c('li',[_v("使用"),_c('strong',[_v("倒排索引服务")]),_v("来查找匹配查询的文档\n"),_c('ul',[_c('li',[_c('strong',[_v("倒排索引服务")]),_v("对匹配到的结果进行排名，然后返回最符合的结果")])])]),_v(" "),_c('li',[_v("使用"),_c('strong',[_v("文档服务")]),_v("返回文章标题与摘要")])])])]),_v(" "),_c('p',[_v("我们使用  "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%A1%A8%E8%BF%B0%E6%80%A7%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BBrest"}},[_c('strong',[_v("REST API")])]),_v(" 与客户端通信：")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs"}},[_c('span',[_v("$ curl https://search.com/api/v1/search?query=hello+world\n")])])]),_c('p',[_v("响应内容:")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs"}},[_c('span',[_v("{\n")]),_c('span',[_v("    \"title\": \"foo's title\",\n")]),_c('span',[_v("    \"snippet\": \"foo's snippet\",\n")]),_c('span',[_v("    \"link\": \"https://foo.com\",\n")]),_c('span',[_v("},\n")]),_c('span',[_v("{\n")]),_c('span',[_v("    \"title\": \"bar's title\",\n")]),_c('span',[_v("    \"snippet\": \"bar's snippet\",\n")]),_c('span',[_v("    \"link\": \"https://bar.com\",\n")]),_c('span',[_v("},\n")]),_c('span',[_v("{\n")]),_c('span',[_v("    \"title\": \"baz's title\",\n")]),_c('span',[_v("    \"snippet\": \"baz's snippet\",\n")]),_c('span',[_v("    \"link\": \"https://baz.com\",\n")]),_c('span',[_v("},\n")])])]),_c('p',[_v("对于服务器内部通信，我们可以使用 "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%BF%9C%E7%A8%8B%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8%E5%8D%8F%E8%AE%AErpc"}},[_v("远程过程调用协议（RPC）")])]),_v(" "),_c('h2',{attrs:{"id":"-15"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-15"}}),_v("第四步：架构扩展"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-15","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("根据限制条件，找到并解决瓶颈。")])]),_v(" "),_c('p',[_c('a',{attrs:{"href":"http://i.imgur.com/bWxPtQA.png","target":"_self"}},[_c('img',{staticClass:"img-fluid",attrs:{"src":"http://i.imgur.com/bWxPtQA.png","alt":""}})])]),_v(" "),_c('p',[_c('strong',[_v("重要提示：不要直接从最初设计跳到最终设计！")])]),_v(" "),_c('p',[_v("现在你要 1) "),_c('strong',[_v("基准测试、负载测试")]),_v("。2) "),_c('strong',[_v("分析、描述")]),_v("性能瓶颈。3) 在解决瓶颈问题的同时，评估替代方案、权衡利弊。4) 重复以上步骤。请阅读"),_c('a',{attrs:{"href":"/mazx4960.github.io/system-design-primer/solutions/system_design/scaling_aws/README.html"}},[_v("设计一个系统，并将其扩大到为数以百万计的 AWS 用户服务")]),_v(" 来了解如何逐步扩大初始设计。")]),_v(" "),_c('p',[_v("讨论初始设计可能遇到的瓶颈及相关解决方案是很重要的。例如加上一套配备多台 "),_c('strong',[_v("Web 服务器")]),_v("的"),_c('strong',[_v("负载均衡器")]),_v("是否能够解决问题？"),_c('strong',[_v("CDN")]),_v("呢？"),_c('strong',[_v("主从复制")]),_v("呢？它们各自的替代方案和需要"),_c('strong',[_v("权衡")]),_v("的利弊又有哪些呢？")]),_v(" "),_c('p',[_v("我们将会介绍一些组件来完成设计，并解决架构规模扩张问题。内置的负载均衡器将不做讨论以节省篇幅。")]),_v(" "),_c('p',[_c('strong',[_v("为了避免重复讨论")]),_v("，请参考"),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%BB%E9%A2%98%E7%9A%84%E7%B4%A2%E5%BC%95"}},[_v("系统设计主题索引")]),_v("相关部分来了解其要点、方案的权衡取舍以及替代方案。")]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F"}},[_v("DNS")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8"}},[_v("负载均衡器")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%B0%B4%E5%B9%B3%E6%89%A9%E5%B1%95"}},[_v("水平扩展")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86web-%E6%9C%8D%E5%8A%A1%E5%99%A8"}},[_v("Web 服务器（反向代理）")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%BA%94%E7%94%A8%E5%B1%82"}},[_v("API 服务器（应用层）")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%BC%93%E5%AD%98"}},[_v("缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#nosql"}},[_v("NoSQL")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E4%B8%80%E8%87%B4%E6%80%A7%E6%A8%A1%E5%BC%8F"}},[_v("一致性模式")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%8F%AF%E7%94%A8%E6%80%A7%E6%A8%A1%E5%BC%8F"}},[_v("可用性模式")])])]),_v(" "),_c('p',[_v("有些搜索词非常热门，有些则非常冷门。热门的搜索词可以通过诸如 Redis 或者 Memcached 之类的"),_c('strong',[_v("内存缓存")]),_v("来缩短响应时间，避免"),_c('strong',[_v("倒排索引服务")]),_v("以及"),_c('strong',[_v("文档服务")]),_v("过载。"),_c('strong',[_v("内存缓存")]),_v("同样适用于流量分布不均匀以及流量短时高峰问题。从内存中读取 1 MB  连续数据大约需要 250 微秒，而从 SSD 读取同样大小的数据要花费 4 倍的时间，从机械硬盘读取需要花费 80 倍以上的时间。"),_c('sup',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#每个程序员都应该知道的延迟数"}},[_v("1")])])]),_v(" "),_c('p',[_v("以下是优化"),_c('strong',[_v("爬虫服务")]),_v("的其他建议：")]),_v(" "),_c('ul',[_c('li',[_v("为了处理数据大小问题以及网络请求负载，"),_c('strong',[_v("倒排索引服务")]),_v("和"),_c('strong',[_v("文档服务")]),_v("可能需要大量应用数据分片和数据复制。")]),_v(" "),_c('li',[_v("DNS 查询可能会成为瓶颈，"),_c('strong',[_v("爬虫服务")]),_v("最好专门维护一套定期更新的 DNS 查询服务。")]),_v(" "),_c('li',[_v("借助于"),_c('a',{attrs:{"href":"https://en.wikipedia.org/wiki/Connection_pool"}},[_v("连接池")]),_v("，即同时维持多个开放网络连接，可以提升"),_c('strong',[_v("爬虫服务")]),_v("的性能并减少内存使用量。\n"),_c('ul',[_c('li',[_v("改用 "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%8D%8F%E8%AE%AEudp"}},[_v("UDP")]),_v(" 协议同样可以提升性能")])])]),_v(" "),_c('li',[_v("网络爬虫受带宽影响较大，请确保带宽足够维持高吞吐量。")])]),_v(" "),_c('h2',{attrs:{"id":"-16"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-16"}}),_v("其它要点"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-16","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("是否深入这些额外的主题，取决于你的问题范围和剩下的时间。")])]),_v(" "),_c('h3',{attrs:{"id":"sql"}},[_c('span',{staticClass:"anchor",attrs:{"id":"sql"}}),_v("SQL 扩展模式"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#sql","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"}},[_v("读取复制")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%81%94%E5%90%88"}},[_v("联合")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%88%86%E7%89%87"}},[_v("分片")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E9%9D%9E%E8%A7%84%E8%8C%83%E5%8C%96"}},[_v("非规范化")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#sql-%E8%B0%83%E4%BC%98"}},[_v("SQL 调优")])])]),_v(" "),_c('h4',{attrs:{"id":"nosql"}},[_c('span',{staticClass:"anchor",attrs:{"id":"nosql"}}),_v("NoSQL"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#nosql","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E9%94%AE-%E5%80%BC%E5%AD%98%E5%82%A8"}},[_v("键-值存储")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%96%87%E6%A1%A3%E7%B1%BB%E5%9E%8B%E5%AD%98%E5%82%A8"}},[_v("文档类型存储")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%88%97%E5%9E%8B%E5%AD%98%E5%82%A8"}},[_v("列型存储")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93"}},[_v("图数据库")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#sql-%E8%BF%98%E6%98%AF-nosql"}},[_v("SQL vs NoSQL")])])]),_v(" "),_c('h3',{attrs:{"id":"-17"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-17"}}),_v("缓存"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-17","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("在哪缓存\n"),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%93%E5%AD%98"}},[_v("客户端缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#cdn-%E7%BC%93%E5%AD%98"}},[_v("CDN 缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#web-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%93%E5%AD%98"}},[_v("Web 服务器缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%93%E5%AD%98"}},[_v("数据库缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%BA%94%E7%94%A8%E7%BC%93%E5%AD%98"}},[_v("应用缓存")])])])]),_v(" "),_c('li',[_v("什么需要缓存\n"),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2%E7%BA%A7%E5%88%AB%E7%9A%84%E7%BC%93%E5%AD%98"}},[_v("数据库查询级别的缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%AF%B9%E8%B1%A1%E7%BA%A7%E5%88%AB%E7%9A%84%E7%BC%93%E5%AD%98"}},[_v("对象级别的缓存")])])])]),_v(" "),_c('li',[_v("何时更新缓存\n"),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%BC%93%E5%AD%98%E6%A8%A1%E5%BC%8F"}},[_v("缓存模式")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E7%9B%B4%E5%86%99%E6%A8%A1%E5%BC%8F"}},[_v("直写模式")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%9B%9E%E5%86%99%E6%A8%A1%E5%BC%8F"}},[_v("回写模式")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%88%B7%E6%96%B0"}},[_v("刷新")])])])])]),_v(" "),_c('h3',{attrs:{"id":"-18"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-18"}}),_v("异步与微服务"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-18","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"}},[_v("消息队列")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97"}},[_v("任务队列")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%83%8C%E5%8E%8B"}},[_v("背压")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%BE%AE%E6%9C%8D%E5%8A%A1"}},[_v("微服务")])])]),_v(" "),_c('h3',{attrs:{"id":"-19"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-19"}}),_v("通信"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-19","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("可权衡选择的方案：\n"),_c('ul',[_c('li',[_v("与客户端的外部通信 - "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%A1%A8%E8%BF%B0%E6%80%A7%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BBrest"}},[_v("使用 REST 作为 HTTP API")])]),_v(" "),_c('li',[_v("内部通信 - "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E8%BF%9C%E7%A8%8B%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8%E5%8D%8F%E8%AE%AErpc"}},[_v("RPC")])])])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0"}},[_v("服务发现")])])]),_v(" "),_c('h3',{attrs:{"id":"-20"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-20"}}),_v("安全性"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-20","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("请参阅"),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E5%AE%89%E5%85%A8"}},[_v("安全")]),_v("。")]),_v(" "),_c('h3',{attrs:{"id":"-21"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-21"}}),_v("延迟数值"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-21","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("请参阅"),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md#%E6%AF%8F%E4%B8%AA%E7%A8%8B%E5%BA%8F%E5%91%98%E9%83%BD%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84%E5%BB%B6%E8%BF%9F%E6%95%B0"}},[_v("每个程序员都应该知道的延迟数")]),_v("。")]),_v(" "),_c('h3',{attrs:{"id":"-22"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-22"}}),_v("持续探讨"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-22","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("持续进行基准测试并监控你的系统，以解决他们提出的瓶颈问题。")]),_v(" "),_c('li',[_v("架构扩展是一个迭代的过程。")])]),_v(" "),_c('i',{staticClass:"fa fa-arrow-circle-up fa-lg d-print-none",attrs:{"id":"scroll-top-button","onclick":"handleScrollTop()","aria-hidden":"true"}})])}
},function anonymous(
) {
with(this){return _c('footer',[_c('div',{staticClass:"text-center"},[_c('small',[_v("[Generated by "),_c('a',{attrs:{"href":"https://markbind.org/"}},[_v("MarkBind 3.1.1")]),_v("]")])])])}
}];
  