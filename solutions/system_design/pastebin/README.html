<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="generator" content="MarkBind 3.1.1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link rel="stylesheet" href="../../../markbind/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../../markbind/css/bootstrap-vue.min.css">
    <link rel="stylesheet" href="../../../markbind/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="../../../markbind/glyphicons/css/bootstrap-glyphicons.min.css">
    <link rel="stylesheet" href="../../../markbind/css/octicons.css">
    <link rel="stylesheet" href="../../../markbind/material-icons/material-icons.css">
    <link rel="stylesheet" href="../../../markbind/css/codeblock-dark.min.css"><link rel="stylesheet" href="../../../markbind/css/markbind.min.css"><script src="../../../markbind/js/polyfill.min.js"></script>
    <script src="../../../markbind/js/vue.min.js"></script>
    <script src="../../../markbind/js/markbind.min.js"></script>
    <script src="README.page-vue-render.js"></script>
    <script src="../../../markbind/js/jquery.min.js"></script><link rel="stylesheet" href="https:/mazx4960.github.io/system-design-primer/plugins/markbind-plugin-anchors/markbind-plugin-anchors.css">
    
  <link rel="stylesheet" href="https://mazx4960.github.io/system-design-primer//stylesheets/main.css">
</head>
<script>
  const baseUrl = 'https://mazx4960.github.io/system-design-primer/'
</script>
<body  data-spy="scroll" data-target="#mb-page-nav" data-offset="100" >
<div id="app" data-server-rendered="true"><header fixed=""><div data-v-15113a2f><nav class="navbar navbar-expand-md navbar-dark bg-dark" data-v-15113a2f><div class="container-fluid" data-v-15113a2f><div class="navbar-left" data-v-15113a2f><a href="https://mazx4960.github.io/system-design-primer//index.html" title="Home" class="navbar-brand" data-v-15113a2f>System Design Primer</a></div> <div class="navbar-default" data-v-15113a2f><ul class="navbar-nav mr-auto mt-2 mt-lg-0" data-v-15113a2f> <li class="nav-link dropdown" data-v-2e98b3f0><a role="button" class="dropdown-toggle" data-v-2e98b3f0>Solutions</a> <ul class="dropdown-menu" data-v-2e98b3f0> <li data-v-2e98b3f0><a href="https://mazx4960.github.io/system-design-primer//solutions/system_design/mint/readme.html" class="dropdown-item" data-v-2e98b3f0>mint</a></li> <li data-v-2e98b3f0><a href="https://mazx4960.github.io/system-design-primer//solutions/system_design/pastebin/readme.html" class="dropdown-item" data-v-2e98b3f0>pastebin</a></li> <li data-v-2e98b3f0><a href="https://mazx4960.github.io/system-design-primer//solutions/system_design/query_cache/readme.html" class="dropdown-item" data-v-2e98b3f0>query_cache</a></li> <li data-v-2e98b3f0><a href="https://mazx4960.github.io/system-design-primer//solutions/system_design/sales_rank/readme.html" class="dropdown-item" data-v-2e98b3f0>sales_rank</a></li> <li data-v-2e98b3f0><a href="https://mazx4960.github.io/system-design-primer//solutions/system_design/scaling_aws/readme.html" class="dropdown-item" data-v-2e98b3f0>scaling_aws</a></li> <li data-v-2e98b3f0><a href="https://mazx4960.github.io/system-design-primer//solutions/system_design/social_graph/readme.html" class="dropdown-item" data-v-2e98b3f0>social_graph</a></li> <li data-v-2e98b3f0><a href="https://mazx4960.github.io/system-design-primer//solutions/system_design/twitter/readme.html" class="dropdown-item" data-v-2e98b3f0>twitter</a></li> <li data-v-2e98b3f0><a href="https://mazx4960.github.io/system-design-primer//solutions/system_design/web_crawler/readme.html" class="dropdown-item" data-v-2e98b3f0>web_crawler</a></li></ul></li></ul></div> <ul class="navbar-nav navbar-right" data-v-15113a2f><li data-v-15113a2f><form class="navbar-form" data-v-15113a2f><div style="position:relative;"><input type="text" placeholder="Search" autocomplete="off" value="" class="form-control"> <ul class="dropdown-menu search-dropdown-menu dropdown-menu-right"></ul></div></form></li></ul></div></nav> <div class="lower-navbar-container" style="display:none;" data-v-15113a2f><!----> <!----></div></div></header> <div id="flex-body"><nav id="site-nav" class="fixed-header-padding" data-v-e8c82f88><div class="site-nav-top" data-v-e8c82f88><div class="font-weight-bold mb-2" style="font-size:1.25rem;" data-v-e8c82f88>Topics</div></div> <div class="nav-component slim-scroll" data-v-e8c82f88><div class="site-nav-root"><ul class="site-nav-list site-nav-list-root" data-v-e8c82f88><li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88>Preface

<i onclick="handleSiteNavClick(this.parentNode, false); event.stopPropagation();" class="site-nav-dropdown-btn-icon" data-v-e8c82f88><span aria-hidden="true" class="glyphicon glyphicon-menu-down" data-v-e8c82f88></span></i></div><ul class="site-nav-dropdown-container site-nav-list" data-v-e8c82f88><li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Motivation.html" data-v-e8c82f88>Motivation</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Ankiflashcards.html" data-v-e8c82f88>Anki flashcards</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Indexof-system-design-topics.html" data-v-e8c82f88>Index</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Studyguide.html" data-v-e8c82f88>Study Guide</a></div></li></ul></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88>Interview Questions

<i onclick="handleSiteNavClick(this.parentNode, false); event.stopPropagation();" class="site-nav-dropdown-btn-icon" data-v-e8c82f88><span aria-hidden="true" class="glyphicon glyphicon-menu-down" data-v-e8c82f88></span></i></div><ul class="site-nav-dropdown-container site-nav-list" data-v-e8c82f88><li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Howto-approach-a-system-design-interview-question.html" data-v-e8c82f88>How to approach a system design interview question</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Object-orienteddesign-interview-questions-with-solutions.html" data-v-e8c82f88>OOP interview questions</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Systemdesign-interview-questions-with-solutions.html" data-v-e8c82f88>System design interview questions</a></div></li></ul></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Systemdesign-topics-start-here.html" data-v-e8c82f88>System design topics</a> <i onclick="handleSiteNavClick(this.parentNode, false); event.stopPropagation();" class="site-nav-dropdown-btn-icon" data-v-e8c82f88><span aria-hidden="true" class="glyphicon glyphicon-menu-down" data-v-e8c82f88></span></i></div><ul class="site-nav-dropdown-container site-nav-list" data-v-e8c82f88><li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Performancevs-scalability.html" data-v-e8c82f88>Performance vs scalability</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Latencyvs-throughput.html" data-v-e8c82f88>Latency vs throughput</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Availabilityvs-consistency.html" data-v-e8c82f88>Availability vs consistency</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Consistencypatterns.html" data-v-e8c82f88>Consistency patterns</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Availabilitypatterns.html" data-v-e8c82f88>Availability patterns</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Domainname-system.html" data-v-e8c82f88>Domain name system</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Contentdelivery-network.html" data-v-e8c82f88>Content delivery network</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Loadbalancer.html" data-v-e8c82f88>Load balancer</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Reverseproxy-(web-server).html" data-v-e8c82f88>Reverse proxy (web server)</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Applicationlayer.html" data-v-e8c82f88>Application layer</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Database.html" data-v-e8c82f88>Database</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Cache.html" data-v-e8c82f88>Cache</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Asynchronism.html" data-v-e8c82f88>Asynchronism</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Communication.html" data-v-e8c82f88>Communication</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Security.html" data-v-e8c82f88>Security</a></div></li></ul></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-0" data-v-e8c82f88>Misc

<i onclick="handleSiteNavClick(this.parentNode, false); event.stopPropagation();" class="site-nav-dropdown-btn-icon" data-v-e8c82f88><span aria-hidden="true" class="glyphicon glyphicon-menu-down" data-v-e8c82f88></span></i></div><ul class="site-nav-dropdown-container site-nav-list" data-v-e8c82f88><li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Appendix.html" data-v-e8c82f88>Appendix</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Underdevelopment.html" data-v-e8c82f88>Under development</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Credits.html" data-v-e8c82f88>Credits</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Contactinfo.html" data-v-e8c82f88>Contact info</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/Contributing.html" data-v-e8c82f88>Contributing</a></div></li> <li data-v-e8c82f88><div onclick="handleSiteNavClick(this)" class="site-nav-default-list-item site-nav-list-item-1" data-v-e8c82f88><a href="https://mazx4960.github.io/system-design-primer//contents/License.html" data-v-e8c82f88>License</a></div></li></ul></li> <!----></ul></div></div> <!----></nav> <div id="content-wrapper" class="fixed-header-padding"><h1 id="design-pastebin-com-or-bit-ly"><span id="design-pastebin-com-or-bit-ly" class="anchor"></span>Design <a href="http://Pastebin.com">Pastebin.com</a> (or <a href="http://Bit.ly">Bit.ly</a>)<a href="#design-pastebin-com-or-bit-ly" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h1> <p><em>Note: This document links directly to relevant areas found in the <a href="https://github.com/donnemartin/system-design-primer#index-of-system-design-topics">system design topics</a> to avoid duplication.  Refer to the linked content for general talking points, tradeoffs, and alternatives.</em></p> <p><strong>Design <a href="http://Bit.ly">Bit.ly</a></strong> - is a similar question, except pastebin requires storing the paste contents instead of the original unshortened url.</p> <h2 id="step-1-outline-use-cases-and-constraints"><span id="step-1-outline-use-cases-and-constraints" class="anchor"></span>Step 1: Outline use cases and constraints<a href="#step-1-outline-use-cases-and-constraints" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h2> <blockquote><p>Gather requirements and scope the problem.
Ask questions to clarify use cases and constraints.
Discuss assumptions.</p></blockquote> <p>Without an interviewer to address clarifying questions, we'll define some use cases and constraints.</p> <h3 id="use-cases"><span id="use-cases" class="anchor"></span>Use cases<a href="#use-cases" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <h4 id="we-ll-scope-the-problem-to-handle-only-the-following-use-cases"><span id="we-ll-scope-the-problem-to-handle-only-the-following-use-cases" class="anchor"></span>We'll scope the problem to handle only the following use cases<a href="#we-ll-scope-the-problem-to-handle-only-the-following-use-cases" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h4> <ul><li><strong>User</strong> enters a block of text and gets a randomly generated link
<ul><li>Expiration
<ul><li>Default setting does not expire</li> <li>Can optionally set a timed expiration</li></ul></li></ul></li> <li><strong>User</strong> enters a paste's url and views the contents</li> <li><strong>User</strong> is anonymous</li> <li><strong>Service</strong> tracks analytics of pages
<ul><li>Monthly visit stats</li></ul></li> <li><strong>Service</strong> deletes expired pastes</li> <li><strong>Service</strong> has high availability</li></ul> <h4 id="out-of-scope"><span id="out-of-scope" class="anchor"></span>Out of scope<a href="#out-of-scope" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h4> <ul><li><strong>User</strong> registers for an account
<ul><li><strong>User</strong> verifies email</li></ul></li> <li><strong>User</strong> logs into a registered account
<ul><li><strong>User</strong> edits the document</li></ul></li> <li><strong>User</strong> can set visibility</li> <li><strong>User</strong> can set the shortlink</li></ul> <h3 id="constraints-and-assumptions"><span id="constraints-and-assumptions" class="anchor"></span>Constraints and assumptions<a href="#constraints-and-assumptions" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <h4 id="state-assumptions"><span id="state-assumptions" class="anchor"></span>State assumptions<a href="#state-assumptions" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h4> <ul><li>Traffic is not evenly distributed</li> <li>Following a short link should be fast</li> <li>Pastes are text only</li> <li>Page view analytics do not need to be realtime</li> <li>10 million users</li> <li>10 million paste writes per month</li> <li>100 million paste reads per month</li> <li>10:1 read to write ratio</li></ul> <h4 id="calculate-usage"><span id="calculate-usage" class="anchor"></span>Calculate usage<a href="#calculate-usage" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h4> <p><strong>Clarify with your interviewer if you should run back-of-the-envelope usage calculations.</strong></p> <ul><li>Size per paste
<ul><li>1 KB content per paste</li> <li><code class="hljs inline no-lang">shortlink</code> - 7 bytes</li> <li><code class="hljs inline no-lang">expiration_length_in_minutes</code> - 4 bytes</li> <li><code class="hljs inline no-lang">created_at</code> - 5 bytes</li> <li><code class="hljs inline no-lang">paste_path</code> - 255 bytes</li> <li>total = ~1.27 KB</li></ul></li> <li>12.7 GB of new paste content per month
<ul><li>1.27 KB per paste * 10 million pastes per month</li> <li>~450 GB of new paste content in 3 years</li> <li>360 million shortlinks in 3 years</li> <li>Assume most are new pastes instead of updates to existing ones</li></ul></li> <li>4 paste writes per second on average</li> <li>40 read requests per second on average</li></ul> <p>Handy conversion guide:</p> <ul><li>2.5 million seconds per month</li> <li>1 request per second = 2.5 million requests per month</li> <li>40 requests per second = 100 million requests per month</li> <li>400 requests per second = 1 billion requests per month</li></ul> <h2 id="step-2-create-a-high-level-design"><span id="step-2-create-a-high-level-design" class="anchor"></span>Step 2: Create a high level design<a href="#step-2-create-a-high-level-design" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h2> <blockquote><p>Outline a high level design with all important components.</p></blockquote> <p><a href="http://i.imgur.com/BKsBnmG.png" target="_self"><img src="http://i.imgur.com/BKsBnmG.png" alt="" class="img-fluid"></a></p> <h2 id="step-3-design-core-components"><span id="step-3-design-core-components" class="anchor"></span>Step 3: Design core components<a href="#step-3-design-core-components" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h2> <blockquote><p>Dive into details for each core component.</p></blockquote> <h3 id="use-case-user-enters-a-block-of-text-and-gets-a-randomly-generated-link"><span id="use-case-user-enters-a-block-of-text-and-gets-a-randomly-generated-link" class="anchor"></span>Use case: User enters a block of text and gets a randomly generated link<a href="#use-case-user-enters-a-block-of-text-and-gets-a-randomly-generated-link" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <p>We could use a <a href="https://github.com/donnemartin/system-design-primer#relational-database-management-system-rdbms">relational database</a> as a large hash table, mapping the generated url to a file server and path containing the paste file.</p> <p>Instead of managing a file server, we could use a managed <strong>Object Store</strong> such as Amazon S3 or a <a href="https://github.com/donnemartin/system-design-primer#document-store">NoSQL document store</a>.</p> <p>An alternative to a relational database acting as a large hash table, we could use a <a href="https://github.com/donnemartin/system-design-primer#key-value-store">NoSQL key-value store</a>.  We should discuss the <a href="https://github.com/donnemartin/system-design-primer#sql-or-nosql">tradeoffs between choosing SQL or NoSQL</a>.  The following discussion uses the relational database approach.</p> <ul><li>The <strong>Client</strong> sends a create paste request to the <strong>Web Server</strong>, running as a <a href="https://github.com/donnemartin/system-design-primer#reverse-proxy-web-server">reverse proxy</a></li> <li>The <strong>Web Server</strong> forwards the request to the <strong>Write API</strong> server</li> <li>The <strong>Write API</strong> server does the following:
<ul><li>Generates a unique url
<ul><li>Checks if the url is unique by looking at the <strong>SQL Database</strong> for a duplicate</li> <li>If the url is not unique, it generates another url</li> <li>If we supported a custom url, we could use the user-supplied (also check for a duplicate)</li></ul></li> <li>Saves to the <strong>SQL Database</strong> <code class="hljs inline no-lang">pastes</code> table</li> <li>Saves the paste data to the <strong>Object Store</strong></li> <li>Returns the url</li></ul></li></ul> <p><strong>Clarify with your interviewer how much code you are expected to write</strong>.</p> <p>The <code class="hljs inline no-lang">pastes</code> table could have the following structure:</p> <pre><code class="hljs"><span>shortlink char(7) NOT NULL
</span><span>expiration_length_in_minutes int NOT NULL
</span><span>created_at datetime NOT NULL
</span><span>paste_path varchar(255) NOT NULL
</span><span>PRIMARY KEY(shortlink)
</span></code></pre><p>Setting the primary key to be based on the <code class="hljs inline no-lang">shortlink</code> column creates an <a href="https://github.com/donnemartin/system-design-primer#use-good-indices">index</a> that the database uses to enforce uniqueness. We'll create an additional index on <code class="hljs inline no-lang">created_at</code> to speed up lookups (log-time instead of scanning the entire table) and to keep the data in memory.  Reading 1 MB sequentially from memory takes about 250 microseconds, while reading from SSD takes 4x and from disk takes 80x longer.<sup><a href="https://github.com/donnemartin/system-design-primer#latency-numbers-every-programmer-should-know">1</a></sup></p> <p>To generate the unique url, we could:</p> <ul><li>Take the <a href="https://en.wikipedia.org/wiki/MD5"><strong>MD5</strong></a> hash of the user's ip_address + timestamp
<ul><li>MD5 is a widely used hashing function that produces a 128-bit hash value</li> <li>MD5 is uniformly distributed</li> <li>Alternatively, we could also take the MD5 hash of randomly-generated data</li></ul></li> <li><a href="https://www.kerstner.at/2012/07/shortening-strings-using-base-62-encoding/"><strong>Base 62</strong></a> encode the MD5 hash
<ul><li>Base 62 encodes to <code class="hljs inline no-lang">[a-zA-Z0-9]</code> which works well for urls, eliminating the need for escaping special characters</li> <li>There is only one hash result for the original input and Base 62 is deterministic (no randomness involved)</li> <li>Base 64 is another popular encoding but provides issues for urls because of the additional <code class="hljs inline no-lang">+</code> and <code class="hljs inline no-lang">/</code> characters</li> <li>The following <a href="http://stackoverflow.com/questions/742013/how-to-code-a-url-shortener">Base 62 pseudocode</a> runs in O(k) time where k is the number of digits = 7:</li></ul></li></ul> <pre><code class="hljs python"><span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">base_encode</span>(<span class="hljs-params">num, base=<span class="hljs-number">62</span></span>):</span>
</span><span>    digits = []
</span><span>    <span class="hljs-keyword">while</span> num &gt; <span class="hljs-number">0</span>
</span><span>      remainder = modulo(num, base)
</span><span>      digits.push(remainder)
</span><span>      num = divide(num, base)
</span><span>    digits = digits.reverse
</span></code></pre><ul><li>Take the first 7 characters of the output, which results in 62^7 possible values and should be sufficient to handle our constraint of 360 million shortlinks in 3 years:</li></ul> <pre><code class="hljs python"><span>url = base_encode(md5(ip_address+timestamp))[:URL_LENGTH]
</span></code></pre><p>We'll use a public <a href="https://github.com/donnemartin/system-design-primer#representational-state-transfer-rest"><strong>REST API</strong></a>:</p> <pre><code class="hljs"><span>$ curl -X POST --data '{ &quot;expiration_length_in_minutes&quot;: &quot;60&quot;, \
</span><span>    &quot;paste_contents&quot;: &quot;Hello World!&quot; }' https://pastebin.com/api/v1/paste
</span></code></pre><p>Response:</p> <pre><code class="hljs"><span>{
</span><span>    &quot;shortlink&quot;: &quot;foobar&quot;
</span><span>}
</span></code></pre><p>For internal communications, we could use <a href="https://github.com/donnemartin/system-design-primer#remote-procedure-call-rpc">Remote Procedure Calls</a>.</p> <h3 id="use-case-user-enters-a-paste-s-url-and-views-the-contents"><span id="use-case-user-enters-a-paste-s-url-and-views-the-contents" class="anchor"></span>Use case: User enters a paste's url and views the contents<a href="#use-case-user-enters-a-paste-s-url-and-views-the-contents" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <ul><li>The <strong>Client</strong> sends a get paste request to the <strong>Web Server</strong></li> <li>The <strong>Web Server</strong> forwards the request to the <strong>Read API</strong> server</li> <li>The <strong>Read API</strong> server does the following:
<ul><li>Checks the <strong>SQL Database</strong> for the generated url
<ul><li>If the url is in the <strong>SQL Database</strong>, fetch the paste contents from the <strong>Object Store</strong></li> <li>Else, return an error message for the user</li></ul></li></ul></li></ul> <p>REST API:</p> <pre><code class="hljs"><span>$ curl https://pastebin.com/api/v1/paste?shortlink=foobar
</span></code></pre><p>Response:</p> <pre><code class="hljs"><span>{
</span><span>    &quot;paste_contents&quot;: &quot;Hello World&quot;
</span><span>    &quot;created_at&quot;: &quot;YYYY-MM-DD HH:MM:SS&quot;
</span><span>    &quot;expiration_length_in_minutes&quot;: &quot;60&quot;
</span><span>}
</span></code></pre><h3 id="use-case-service-tracks-analytics-of-pages"><span id="use-case-service-tracks-analytics-of-pages" class="anchor"></span>Use case: Service tracks analytics of pages<a href="#use-case-service-tracks-analytics-of-pages" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <p>Since realtime analytics are not a requirement, we could simply <strong>MapReduce</strong> the <strong>Web Server</strong> logs to generate hit counts.</p> <p><strong>Clarify with your interviewer how much code you are expected to write</strong>.</p> <pre><code class="hljs python"><span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HitCounts</span>(<span class="hljs-params">MRJob</span>):</span>
</span><span>
</span><span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extract_url</span>(<span class="hljs-params">self, line</span>):</span>
</span><span>        <span class="hljs-string">&quot;&quot;&quot;Extract the generated url from the log line.&quot;&quot;&quot;</span>
</span><span>        ...
</span><span>
</span><span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extract_year_month</span>(<span class="hljs-params">self, line</span>):</span>
</span><span>        <span class="hljs-string">&quot;&quot;&quot;Return the year and month portions of the timestamp.&quot;&quot;&quot;</span>
</span><span>        ...
</span><span>
</span><span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mapper</span>(<span class="hljs-params">self, _, line</span>):</span>
</span><span>        <span class="hljs-string">&quot;&quot;&quot;Parse each log line, extract and transform relevant lines.</span>
</span><span><span class="hljs-string"></span>
</span><span><span class="hljs-string">        Emit key value pairs of the form:</span>
</span><span><span class="hljs-string"></span>
</span><span><span class="hljs-string">        (2016-01, url0), 1</span>
</span><span><span class="hljs-string">        (2016-01, url0), 1</span>
</span><span><span class="hljs-string">        (2016-01, url1), 1</span>
</span><span><span class="hljs-string">        &quot;&quot;&quot;</span>
</span><span>        url = self.extract_url(line)
</span><span>        period = self.extract_year_month(line)
</span><span>        <span class="hljs-keyword">yield</span> (period, url), <span class="hljs-number">1</span>
</span><span>
</span><span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reducer</span>(<span class="hljs-params">self, key, values</span>):</span>
</span><span>        <span class="hljs-string">&quot;&quot;&quot;Sum values for each key.</span>
</span><span><span class="hljs-string"></span>
</span><span><span class="hljs-string">        (2016-01, url0), 2</span>
</span><span><span class="hljs-string">        (2016-01, url1), 1</span>
</span><span><span class="hljs-string">        &quot;&quot;&quot;</span>
</span><span>        <span class="hljs-keyword">yield</span> key, <span class="hljs-built_in">sum</span>(values)
</span></code></pre><h3 id="use-case-service-deletes-expired-pastes"><span id="use-case-service-deletes-expired-pastes" class="anchor"></span>Use case: Service deletes expired pastes<a href="#use-case-service-deletes-expired-pastes" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <p>To delete expired pastes, we could just scan the <strong>SQL Database</strong> for all entries whose expiration timestamp are older than the current timestamp.  All expired entries would then be deleted (or  marked as expired) from the table.</p> <h2 id="step-4-scale-the-design"><span id="step-4-scale-the-design" class="anchor"></span>Step 4: Scale the design<a href="#step-4-scale-the-design" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h2> <blockquote><p>Identify and address bottlenecks, given the constraints.</p></blockquote> <p><a href="http://i.imgur.com/4edXG0T.png" target="_self"><img src="http://i.imgur.com/4edXG0T.png" alt="" class="img-fluid"></a></p> <p><strong>Important: Do not simply jump right into the final design from the initial design!</strong></p> <p>State you would do this iteratively: 1) <strong>Benchmark/Load Test</strong>, 2) <strong>Profile</strong> for bottlenecks 3) address bottlenecks while evaluating alternatives and trade-offs, and 4) repeat.  See <a href="/mazx4960.github.io/system-design-primer/solutions/system_design/scaling_aws/README.html">Design a system that scales to millions of users on AWS</a> as a sample on how to iteratively scale the initial design.</p> <p>It's important to discuss what bottlenecks you might encounter with the initial design and how you might address each of them.  For example, what issues are addressed by adding a <strong>Load Balancer</strong> with multiple <strong>Web Servers</strong>?  <strong>CDN</strong>?  <strong>Master-Slave Replicas</strong>?  What are the alternatives and <strong>Trade-Offs</strong> for each?</p> <p>We'll introduce some components to complete the design and to address scalability issues.  Internal load balancers are not shown to reduce clutter.</p> <p><em>To avoid repeating discussions</em>, refer to the following <a href="https://github.com/donnemartin/system-design-primer#index-of-system-design-topics">system design topics</a> for main talking points, tradeoffs, and alternatives:</p> <ul><li><a href="https://github.com/donnemartin/system-design-primer#domain-name-system">DNS</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#content-delivery-network">CDN</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#load-balancer">Load balancer</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#horizontal-scaling">Horizontal scaling</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#reverse-proxy-web-server">Web server (reverse proxy)</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#application-layer">API server (application layer)</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#cache">Cache</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#relational-database-management-system-rdbms">Relational database management system (RDBMS)</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#fail-over">SQL write master-slave failover</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#master-slave-replication">Master-slave replication</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#consistency-patterns">Consistency patterns</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#availability-patterns">Availability patterns</a></li></ul> <p>The <strong>Analytics Database</strong> could use a data warehousing solution such as Amazon Redshift or Google BigQuery.</p> <p>An <strong>Object Store</strong> such as Amazon S3 can comfortably handle the constraint of 12.7 GB of new content per month.</p> <p>To address the 40 <em>average</em> read requests per second (higher at peak), traffic for popular content should be handled by the <strong>Memory Cache</strong> instead of the database.  The <strong>Memory Cache</strong> is also useful for handling the unevenly distributed traffic and traffic spikes.  The <strong>SQL Read Replicas</strong> should be able to handle the cache misses, as long as the replicas are not bogged down with replicating writes.</p> <p>4 <em>average</em> paste writes per second (with higher at peak) should be do-able for a single <strong>SQL Write Master-Slave</strong>.  Otherwise, we'll need to employ additional SQL scaling patterns:</p> <ul><li><a href="https://github.com/donnemartin/system-design-primer#federation">Federation</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#sharding">Sharding</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#denormalization">Denormalization</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#sql-tuning">SQL Tuning</a></li></ul> <p>We should also consider moving some data to a <strong>NoSQL Database</strong>.</p> <h2 id="additional-talking-points"><span id="additional-talking-points" class="anchor"></span>Additional talking points<a href="#additional-talking-points" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h2> <blockquote><p>Additional topics to dive into, depending on the problem scope and time remaining.</p></blockquote> <h4 id="nosql"><span id="nosql" class="anchor"></span>NoSQL<a href="#nosql" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h4> <ul><li><a href="https://github.com/donnemartin/system-design-primer#key-value-store">Key-value store</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#document-store">Document store</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#wide-column-store">Wide column store</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#graph-database">Graph database</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#sql-or-nosql">SQL vs NoSQL</a></li></ul> <h3 id="caching"><span id="caching" class="anchor"></span>Caching<a href="#caching" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <ul><li>Where to cache
<ul><li><a href="https://github.com/donnemartin/system-design-primer#client-caching">Client caching</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#cdn-caching">CDN caching</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#web-server-caching">Web server caching</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#database-caching">Database caching</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#application-caching">Application caching</a></li></ul></li> <li>What to cache
<ul><li><a href="https://github.com/donnemartin/system-design-primer#caching-at-the-database-query-level">Caching at the database query level</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#caching-at-the-object-level">Caching at the object level</a></li></ul></li> <li>When to update the cache
<ul><li><a href="https://github.com/donnemartin/system-design-primer#cache-aside">Cache-aside</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#write-through">Write-through</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#write-behind-write-back">Write-behind (write-back)</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#refresh-ahead">Refresh ahead</a></li></ul></li></ul> <h3 id="asynchronism-and-microservices"><span id="asynchronism-and-microservices" class="anchor"></span>Asynchronism and microservices<a href="#asynchronism-and-microservices" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <ul><li><a href="https://github.com/donnemartin/system-design-primer#message-queues">Message queues</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#task-queues">Task queues</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#back-pressure">Back pressure</a></li> <li><a href="https://github.com/donnemartin/system-design-primer#microservices">Microservices</a></li></ul> <h3 id="communications"><span id="communications" class="anchor"></span>Communications<a href="#communications" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <ul><li>Discuss tradeoffs:
<ul><li>External communication with clients - <a href="https://github.com/donnemartin/system-design-primer#representational-state-transfer-rest">HTTP APIs following REST</a></li> <li>Internal communications - <a href="https://github.com/donnemartin/system-design-primer#remote-procedure-call-rpc">RPC</a></li></ul></li> <li><a href="https://github.com/donnemartin/system-design-primer#service-discovery">Service discovery</a></li></ul> <h3 id="security"><span id="security" class="anchor"></span>Security<a href="#security" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <p>Refer to the <a href="https://github.com/donnemartin/system-design-primer#security">security section</a>.</p> <h3 id="latency-numbers"><span id="latency-numbers" class="anchor"></span>Latency numbers<a href="#latency-numbers" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <p>See <a href="https://github.com/donnemartin/system-design-primer#latency-numbers-every-programmer-should-know">Latency numbers every programmer should know</a>.</p> <h3 id="ongoing"><span id="ongoing" class="anchor"></span>Ongoing<a href="#ongoing" onclick="event.stopPropagation()" class="fa fa-anchor"></a></h3> <ul><li>Continue benchmarking and monitoring your system to address bottlenecks as they come up</li> <li>Scaling is an iterative process</li></ul> <i id="scroll-top-button" onclick="handleScrollTop()" aria-hidden="true" class="fa fa-arrow-circle-up fa-lg d-print-none"></i></div> <nav id="page-nav" class="fixed-header-padding" data-v-e8c82f88><div class="nav-component slim-scroll" data-v-e8c82f88><a class="navbar-brand page-nav-title" href="#" data-v-e8c82f88>Chapters of This Page</a> <nav id="mb-page-nav" class="nav nav-pills flex-column my-0 small no-flex-wrap" data-v-e8c82f88><a class="nav-link py-1" href="#design-pastebin-com-or-bit-ly" data-v-e8c82f88>Design Pastebin.com (or Bit.ly)‎</a> <nav class="nav nav-pills flex-column my-0 nested no-flex-wrap" data-v-e8c82f88><a class="nav-link py-1" href="#step-1-outline-use-cases-and-constraints" data-v-e8c82f88>Step 1: Outline use cases and constraints‎</a> <nav class="nav nav-pills flex-column my-0 nested no-flex-wrap" data-v-e8c82f88><a class="nav-link py-1" href="#use-cases" data-v-e8c82f88>Use cases‎</a> <a class="nav-link py-1" href="#constraints-and-assumptions" data-v-e8c82f88>Constraints and assumptions‎</a></nav> <a class="nav-link py-1" href="#step-2-create-a-high-level-design" data-v-e8c82f88>Step 2: Create a high level design‎</a> <a class="nav-link py-1" href="#step-3-design-core-components" data-v-e8c82f88>Step 3: Design core components‎</a> <nav class="nav nav-pills flex-column my-0 nested no-flex-wrap" data-v-e8c82f88><a class="nav-link py-1" href="#use-case-user-enters-a-block-of-text-and-gets-a-randomly-generated-link" data-v-e8c82f88>Use case: User enters a block of text and gets a randomly generated link‎</a> <a class="nav-link py-1" href="#use-case-user-enters-a-paste-s-url-and-views-the-contents" data-v-e8c82f88>Use case: User enters a paste's url and views the contents‎</a> <a class="nav-link py-1" href="#use-case-service-tracks-analytics-of-pages" data-v-e8c82f88>Use case: Service tracks analytics of pages‎</a> <a class="nav-link py-1" href="#use-case-service-deletes-expired-pastes" data-v-e8c82f88>Use case: Service deletes expired pastes‎</a></nav> <a class="nav-link py-1" href="#step-4-scale-the-design" data-v-e8c82f88>Step 4: Scale the design‎</a> <a class="nav-link py-1" href="#additional-talking-points" data-v-e8c82f88>Additional talking points‎</a> <nav class="nav nav-pills flex-column my-0 nested no-flex-wrap" data-v-e8c82f88><a class="nav-link py-1" href="#caching" data-v-e8c82f88>Caching‎</a> <a class="nav-link py-1" href="#asynchronism-and-microservices" data-v-e8c82f88>Asynchronism and microservices‎</a> <a class="nav-link py-1" href="#communications" data-v-e8c82f88>Communications‎</a> <a class="nav-link py-1" href="#security" data-v-e8c82f88>Security‎</a> <a class="nav-link py-1" href="#latency-numbers" data-v-e8c82f88>Latency numbers‎</a> <a class="nav-link py-1" href="#ongoing" data-v-e8c82f88>Ongoing‎</a></nav></nav> <!----></nav></div> <!----></nav></div> <footer><div class="text-center"><small>[Generated by <a href="https://markbind.org/">MarkBind 3.1.1</a>]</small></div></footer></div>
</body><script src="../../../markbind/js/bootstrap-utility.min.js"></script>
<script>
  MarkBind.setupWithSearch()
</script>
</html>
