
    var pageVueRenderFn = function anonymous(
) {
with(this){return _c('div',{attrs:{"id":"app"}},[_c('header',{attrs:{"fixed":""}},[_c('navbar',{attrs:{"type":"dark"},scopedSlots:_u([{key:"brand",fn:function(){return [_c('a',{staticClass:"navbar-brand",attrs:{"href":"/index.html","title":"Home"}},[_v("System Design Primer")])]},proxy:true},{key:"right",fn:function(){return [_c('li',[_c('form',{staticClass:"navbar-form"},[_c('searchbar',{attrs:{"data":searchData,"placeholder":"Search","on-hit":searchCallback,"menu-align-right":""}})],1)])]},proxy:true}])},[_v(" "),_c('dropdown',{staticClass:"nav-link",scopedSlots:_u([{key:"header",fn:function(){return [_v("Solutions")]},proxy:true}])},[_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/mint/readme.html"}},[_v("mint")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/pastebin/readme.html"}},[_v("pastebin")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/query_cache/readme.html"}},[_v("query_cache")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/sales_rank/readme.html"}},[_v("sales_rank")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/scaling_aws/readme.html"}},[_v("scaling_aws")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/social_graph/readme.html"}},[_v("social_graph")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/twitter/readme.html"}},[_v("twitter")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/web_crawler/readme.html"}},[_v("web_crawler")])])])],1)],1),_v(" "),_c('div',{attrs:{"id":"flex-body"}},[_c('overlay-source',{staticClass:"fixed-header-padding",attrs:{"id":"site-nav","tag-name":"nav","to":"site-nav"}},[_c('div',{staticClass:"site-nav-top"},[_c('div',{staticClass:"font-weight-bold mb-2",staticStyle:{"font-size":"1.25rem"}},[_v("Topics")])]),_v(" "),_c('div',{staticClass:"nav-component slim-scroll"},[_c('site-nav',[_c('overlay-source',{staticClass:"site-nav-list site-nav-list-root",attrs:{"tag-name":"ul","to":"mb-site-nav"}},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_v("Preface\n\n"),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Motivation.html"}},[_v("Motivation")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Ankiflashcards.html"}},[_v("Anki flashcards")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Indexof-system-design-topics.html"}},[_v("Index")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Studyguide.html"}},[_v("Study Guide")])])])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_v("Interview Questions\n\n"),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Howto-approach-a-system-design-interview-question.html"}},[_v("How to approach a system design interview question")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Object-orienteddesign-interview-questions-with-solutions.html"}},[_v("OOP interview questions")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Systemdesign-interview-questions-with-solutions.html"}},[_v("System design interview questions")])])])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Systemdesign-topics-start-here.html"}},[_v("System design topics")]),_v(" "),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Performancevs-scalability.html"}},[_v("Performance vs scalability")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Latencyvs-throughput.html"}},[_v("Latency vs throughput")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Availabilityvs-consistency.html"}},[_v("Availability vs consistency")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Consistencypatterns.html"}},[_v("Consistency patterns")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Availabilitypatterns.html"}},[_v("Availability patterns")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Domainname-system.html"}},[_v("Domain name system")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Contentdelivery-network.html"}},[_v("Content delivery network")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Loadbalancer.html"}},[_v("Load balancer")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Reverseproxy-(web-server).html"}},[_v("Reverse proxy (web server)")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Applicationlayer.html"}},[_v("Application layer")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Database.html"}},[_v("Database")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Cache.html"}},[_v("Cache")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Asynchronism.html"}},[_v("Asynchronism")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Communication.html"}},[_v("Communication")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Security.html"}},[_v("Security")])])])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_v("Misc\n\n"),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Appendix.html"}},[_v("Appendix")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Underdevelopment.html"}},[_v("Under development")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Credits.html"}},[_v("Credits")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Contactinfo.html"}},[_v("Contact info")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Contributing.html"}},[_v("Contributing")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/License.html"}},[_v("License")])])])])])])],1)],1)]),_v(" "),_m(0),_v(" "),_c('overlay-source',{staticClass:"fixed-header-padding",attrs:{"id":"page-nav","tag-name":"nav","to":"page-nav"}},[_c('div',{staticClass:"nav-component slim-scroll"},[_c('a',{pre:true,attrs:{"class":"navbar-brand page-nav-title","href":"#"}},[_v("Chapters of This Page")]),_v(" "),_c('overlay-source',{staticClass:"nav nav-pills flex-column my-0 small no-flex-wrap",attrs:{"id":"mb-page-nav","tag-name":"nav","to":"mb-page-nav"}},[_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#design-the-data-structures-for-a-social-network"}},[_v("Design the data structures for a social network‎")]),_v(" "),_c('nav',{staticClass:"nav nav-pills flex-column my-0 nested no-flex-wrap"},[_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#step-1-outline-use-cases-and-constraints"}},[_v("Step 1: Outline use cases and constraints‎")]),_v(" "),_c('nav',{staticClass:"nav nav-pills flex-column my-0 nested no-flex-wrap"},[_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#use-cases"}},[_v("Use cases‎")]),_v(" "),_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#constraints-and-assumptions"}},[_v("Constraints and assumptions‎")])]),_v(" "),_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#step-2-create-a-high-level-design"}},[_v("Step 2: Create a high level design‎")]),_v(" "),_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#step-3-design-core-components"}},[_v("Step 3: Design core components‎")]),_v(" "),_c('nav',{staticClass:"nav nav-pills flex-column my-0 nested no-flex-wrap"},[_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#use-case-user-searches-for-someone-and-sees-the-shortest-path-to-the-searched-person"}},[_v("Use case: User searches for someone and sees the shortest path to the searched person‎")])]),_v(" "),_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#step-4-scale-the-design"}},[_v("Step 4: Scale the design‎")]),_v(" "),_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#additional-talking-points"}},[_v("Additional talking points‎")]),_v(" "),_c('nav',{staticClass:"nav nav-pills flex-column my-0 nested no-flex-wrap"},[_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#sql-scaling-patterns"}},[_v("SQL scaling patterns‎")]),_v(" "),_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#caching"}},[_v("Caching‎")]),_v(" "),_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#asynchronism-and-microservices"}},[_v("Asynchronism and microservices‎")]),_v(" "),_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#communications"}},[_v("Communications‎")]),_v(" "),_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#security"}},[_v("Security‎")]),_v(" "),_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#latency-numbers"}},[_v("Latency numbers‎")]),_v(" "),_c('a',{pre:true,attrs:{"class":"nav-link py-1","href":"#ongoing"}},[_v("Ongoing‎")])])])])],1)])],1),_v(" "),_m(1)])}
};
    var pageVueStaticRenderFns = [function anonymous(
) {
with(this){return _c('div',{staticClass:"fixed-header-padding",attrs:{"id":"content-wrapper"}},[_c('br'),_v(" "),_c('br'),_v(" "),_c('br'),_v(" "),_c('h1',{attrs:{"id":"design-the-data-structures-for-a-social-network"}},[_c('span',{staticClass:"anchor",attrs:{"id":"design-the-data-structures-for-a-social-network"}}),_v("Design the data structures for a social network"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#design-the-data-structures-for-a-social-network","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_c('em',[_v("Note: This document links directly to relevant areas found in the "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#index-of-system-design-topics"}},[_v("system design topics")]),_v(" to avoid duplication.  Refer to the linked content for general talking points, tradeoffs, and alternatives.")])]),_v(" "),_c('h2',{attrs:{"id":"step-1-outline-use-cases-and-constraints"}},[_c('span',{staticClass:"anchor",attrs:{"id":"step-1-outline-use-cases-and-constraints"}}),_v("Step 1: Outline use cases and constraints"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#step-1-outline-use-cases-and-constraints","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("Gather requirements and scope the problem.\nAsk questions to clarify use cases and constraints.\nDiscuss assumptions.")])]),_v(" "),_c('p',[_v("Without an interviewer to address clarifying questions, we'll define some use cases and constraints.")]),_v(" "),_c('h3',{attrs:{"id":"use-cases"}},[_c('span',{staticClass:"anchor",attrs:{"id":"use-cases"}}),_v("Use cases"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#use-cases","onclick":"event.stopPropagation()"}})]),_v(" "),_c('h4',{attrs:{"id":"we-ll-scope-the-problem-to-handle-only-the-following-use-cases"}},[_c('span',{staticClass:"anchor",attrs:{"id":"we-ll-scope-the-problem-to-handle-only-the-following-use-cases"}}),_v("We'll scope the problem to handle only the following use cases"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#we-ll-scope-the-problem-to-handle-only-the-following-use-cases","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('strong',[_v("User")]),_v(" searches for someone and sees the shortest path to the searched person")]),_v(" "),_c('li',[_c('strong',[_v("Service")]),_v(" has high availability")])]),_v(" "),_c('h3',{attrs:{"id":"constraints-and-assumptions"}},[_c('span',{staticClass:"anchor",attrs:{"id":"constraints-and-assumptions"}}),_v("Constraints and assumptions"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#constraints-and-assumptions","onclick":"event.stopPropagation()"}})]),_v(" "),_c('h4',{attrs:{"id":"state-assumptions"}},[_c('span',{staticClass:"anchor",attrs:{"id":"state-assumptions"}}),_v("State assumptions"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#state-assumptions","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("Traffic is not evenly distributed\n"),_c('ul',[_c('li',[_v("Some searches are more popular than others, while others are only executed once")])])]),_v(" "),_c('li',[_v("Graph data won't fit on a single machine")]),_v(" "),_c('li',[_v("Graph edges are unweighted")]),_v(" "),_c('li',[_v("100 million users")]),_v(" "),_c('li',[_v("50 friends per user average")]),_v(" "),_c('li',[_v("1 billion friend searches per month")])]),_v(" "),_c('p',[_v("Exercise the use of more traditional systems - don't use graph-specific solutions such as "),_c('a',{attrs:{"href":"http://graphql.org/"}},[_v("GraphQL")]),_v(" or a graph database like "),_c('a',{attrs:{"href":"https://neo4j.com/"}},[_v("Neo4j")])]),_v(" "),_c('h4',{attrs:{"id":"calculate-usage"}},[_c('span',{staticClass:"anchor",attrs:{"id":"calculate-usage"}}),_v("Calculate usage"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#calculate-usage","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_c('strong',[_v("Clarify with your interviewer if you should run back-of-the-envelope usage calculations.")])]),_v(" "),_c('ul',[_c('li',[_v("5 billion friend relationships\n"),_c('ul',[_c('li',[_v("100 million users * 50 friends per user average")])])]),_v(" "),_c('li',[_v("400 search requests per second")])]),_v(" "),_c('p',[_v("Handy conversion guide:")]),_v(" "),_c('ul',[_c('li',[_v("2.5 million seconds per month")]),_v(" "),_c('li',[_v("1 request per second = 2.5 million requests per month")]),_v(" "),_c('li',[_v("40 requests per second = 100 million requests per month")]),_v(" "),_c('li',[_v("400 requests per second = 1 billion requests per month")])]),_v(" "),_c('h2',{attrs:{"id":"step-2-create-a-high-level-design"}},[_c('span',{staticClass:"anchor",attrs:{"id":"step-2-create-a-high-level-design"}}),_v("Step 2: Create a high level design"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#step-2-create-a-high-level-design","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("Outline a high level design with all important components.")])]),_v(" "),_c('p',[_c('a',{attrs:{"href":"http://i.imgur.com/wxXyq2J.png","target":"_self"}},[_c('img',{staticClass:"img-fluid",attrs:{"src":"http://i.imgur.com/wxXyq2J.png","alt":""}})])]),_v(" "),_c('h2',{attrs:{"id":"step-3-design-core-components"}},[_c('span',{staticClass:"anchor",attrs:{"id":"step-3-design-core-components"}}),_v("Step 3: Design core components"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#step-3-design-core-components","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("Dive into details for each core component.")])]),_v(" "),_c('h3',{attrs:{"id":"use-case-user-searches-for-someone-and-sees-the-shortest-path-to-the-searched-person"}},[_c('span',{staticClass:"anchor",attrs:{"id":"use-case-user-searches-for-someone-and-sees-the-shortest-path-to-the-searched-person"}}),_v("Use case: User searches for someone and sees the shortest path to the searched person"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#use-case-user-searches-for-someone-and-sees-the-shortest-path-to-the-searched-person","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_c('strong',[_v("Clarify with your interviewer how much code you are expected to write")]),_v(".")]),_v(" "),_c('p',[_v("Without the constraint of millions of users (vertices) and billions of friend relationships (edges), we could solve this unweighted shortest path task with a general BFS approach:")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("Graph")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("Graph")]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("shortest_path")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, source, dest")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" source "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("or")]),_v(" dest "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" source "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" dest:\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" [source.key]\n")]),_c('span',[_v("        prev_node_keys = self._shortest_path(source, dest)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" prev_node_keys "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("else")]),_v(":\n")]),_c('span',[_v("            path_ids = [dest.key]\n")]),_c('span',[_v("            prev_node_key = prev_node_keys[dest.key]\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("while")]),_v(" prev_node_key "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("not")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("                path_ids.append(prev_node_key)\n")]),_c('span',[_v("                prev_node_key = prev_node_keys[prev_node_key]\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" path_ids[::-"),_c('span',{pre:true,attrs:{"class":"hljs-number"}},[_v("1")]),_v("]\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("_shortest_path")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, source, dest")]),_v("):")]),_v("\n")]),_c('span',[_v("        queue = deque()\n")]),_c('span',[_v("        queue.append(source)\n")]),_c('span',[_v("        prev_node_keys = {source.key: "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("}\n")]),_c('span',[_v("        source.visit_state = State.visited\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("while")]),_v(" queue:\n")]),_c('span',[_v("            node = queue.popleft()\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" node "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" dest:\n")]),_c('span',[_v("                "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" prev_node_keys\n")]),_c('span',[_v("            prev_node = node\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("for")]),_v(" adj_node "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("in")]),_v(" node.adj_nodes.values():\n")]),_c('span',[_v("                "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" adj_node.visit_state == State.unvisited:\n")]),_c('span',[_v("                    queue.append(adj_node)\n")]),_c('span',[_v("                    prev_node_keys[adj_node.key] = prev_node.key\n")]),_c('span',[_v("                    adj_node.visit_state = State.visited\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")])])]),_c('p',[_v("We won't be able to fit all users on the same machine, we'll need to "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#sharding"}},[_v("shard")]),_v(" users across "),_c('strong',[_v("Person Servers")]),_v(" and access them with a "),_c('strong',[_v("Lookup Service")]),_v(".")]),_v(" "),_c('ul',[_c('li',[_v("The "),_c('strong',[_v("Client")]),_v(" sends a request to the "),_c('strong',[_v("Web Server")]),_v(", running as a "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#reverse-proxy-web-server"}},[_v("reverse proxy")])]),_v(" "),_c('li',[_v("The "),_c('strong',[_v("Web Server")]),_v(" forwards the request to the "),_c('strong',[_v("Search API")]),_v(" server")]),_v(" "),_c('li',[_v("The "),_c('strong',[_v("Search API")]),_v(" server forwards the request to the "),_c('strong',[_v("User Graph Service")])]),_v(" "),_c('li',[_v("The "),_c('strong',[_v("User Graph Service")]),_v(" does the following:\n"),_c('ul',[_c('li',[_v("Uses the "),_c('strong',[_v("Lookup Service")]),_v(" to find the "),_c('strong',[_v("Person Server")]),_v(" where the current user's info is stored")]),_v(" "),_c('li',[_v("Finds the appropriate "),_c('strong',[_v("Person Server")]),_v(" to retrieve the current user's list of "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("friend_ids")])]),_v(" "),_c('li',[_v("Runs a BFS search using the current user as the "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("source")]),_v(" and the current user's "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("friend_ids")]),_v(" as the ids for each "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("adjacent_node")])]),_v(" "),_c('li',[_v("To get the "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("adjacent_node")]),_v(" from a given id:\n"),_c('ul',[_c('li',[_v("The "),_c('strong',[_v("User Graph Service")]),_v(" will "),_c('em',[_v("again")]),_v(" need to communicate with the "),_c('strong',[_v("Lookup Service")]),_v(" to determine which "),_c('strong',[_v("Person Server")]),_v(" stores the"),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("adjacent_node")]),_v(" matching the given id (potential for optimization)")])])])])])]),_v(" "),_c('p',[_c('strong',[_v("Clarify with your interviewer how much code you should be writing")]),_v(".")]),_v(" "),_c('p',[_c('strong',[_v("Note")]),_v(": Error handling is excluded below for simplicity.  Ask if you should code proper error handing.")]),_v(" "),_c('p',[_c('strong',[_v("Lookup Service")]),_v(" implementation:")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("LookupService")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self")]),_v("):")]),_v("\n")]),_c('span',[_v("        self.lookup = self._init_lookup()  "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# key: person_id, value: person_server")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("_init_lookup")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self")]),_v("):")]),_v("\n")]),_c('span',[_v("        ...\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("lookup_person_server")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, person_id")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" self.lookup[person_id]\n")])])]),_c('p',[_c('strong',[_v("Person Server")]),_v(" implementation:")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("PersonServer")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self")]),_v("):")]),_v("\n")]),_c('span',[_v("        self.people = {}  "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# key: person_id, value: person")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("add_person")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, person")]),_v("):")]),_v("\n")]),_c('span',[_v("        ...\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("people")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, ids")]),_v("):")]),_v("\n")]),_c('span',[_v("        results = []\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("for")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("id")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("in")]),_v(" ids:\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("id")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("in")]),_v(" self.people:\n")]),_c('span',[_v("                results.append(self.people["),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("id")]),_v("])\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" results\n")])])]),_c('p',[_c('strong',[_v("Person")]),_v(" implementation:")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("Person")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, "),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("id")]),_v(", name, friend_ids")]),_v("):")]),_v("\n")]),_c('span',[_v("        self."),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("id")]),_v(" = "),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("id")]),_v("\n")]),_c('span',[_v("        self.name = name\n")]),_c('span',[_v("        self.friend_ids = friend_ids\n")])])]),_c('p',[_c('strong',[_v("User Graph Service")]),_v(" implementation:")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("UserGraphService")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, lookup_service")]),_v("):")]),_v("\n")]),_c('span',[_v("        self.lookup_service = lookup_service\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("person")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, person_id")]),_v("):")]),_v("\n")]),_c('span',[_v("        person_server = self.lookup_service.lookup_person_server(person_id)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" person_server.people([person_id])\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("shortest_path")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, source_key, dest_key")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" source_key "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("or")]),_v(" dest_key "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" source_key "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" dest_key:\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" [source_key]\n")]),_c('span',[_v("        prev_node_keys = self._shortest_path(source_key, dest_key)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" prev_node_keys "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("else")]),_v(":\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# Iterate through the path_ids backwards, starting at dest_key")]),_v("\n")]),_c('span',[_v("            path_ids = [dest_key]\n")]),_c('span',[_v("            prev_node_key = prev_node_keys[dest_key]\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("while")]),_v(" prev_node_key "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("not")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("                path_ids.append(prev_node_key)\n")]),_c('span',[_v("                prev_node_key = prev_node_keys[prev_node_key]\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# Reverse the list since we iterated backwards")]),_v("\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" path_ids[::-"),_c('span',{pre:true,attrs:{"class":"hljs-number"}},[_v("1")]),_v("]\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("_shortest_path")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, source_key, dest_key, path")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# Use the id to get the Person")]),_v("\n")]),_c('span',[_v("        source = self.person(source_key)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# Update our bfs queue")]),_v("\n")]),_c('span',[_v("        queue = deque()\n")]),_c('span',[_v("        queue.append(source)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# prev_node_keys keeps track of each hop from")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# the source_key to the dest_key")]),_v("\n")]),_c('span',[_v("        prev_node_keys = {source_key: "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("}\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# We'll use visited_ids to keep track of which nodes we've")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# visited, which can be different from a typical bfs where")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# this can be stored in the node itself")]),_v("\n")]),_c('span',[_v("        visited_ids = "),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("set")]),_v("()\n")]),_c('span',[_v("        visited_ids.add(source."),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("id")]),_v(")\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("while")]),_v(" queue:\n")]),_c('span',[_v("            node = queue.popleft()\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" node.key "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" dest_key:\n")]),_c('span',[_v("                "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" prev_node_keys\n")]),_c('span',[_v("            prev_node = node\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("for")]),_v(" friend_id "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("in")]),_v(" node.friend_ids:\n")]),_c('span',[_v("                "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" friend_id "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("not")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("in")]),_v(" visited_ids:\n")]),_c('span',[_v("                    friend_node = self.person(friend_id)\n")]),_c('span',[_v("                    queue.append(friend_node)\n")]),_c('span',[_v("                    prev_node_keys[friend_id] = prev_node.key\n")]),_c('span',[_v("                    visited_ids.add(friend_id)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")])])]),_c('p',[_v("We'll use a public "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#representational-state-transfer-rest"}},[_c('strong',[_v("REST API")])]),_v(":")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs"}},[_c('span',[_v("$ curl https://social.com/api/v1/friend_search?person_id=1234\n")])])]),_c('p',[_v("Response:")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs"}},[_c('span',[_v("{\n")]),_c('span',[_v("    \"person_id\": \"100\",\n")]),_c('span',[_v("    \"name\": \"foo\",\n")]),_c('span',[_v("    \"link\": \"https://social.com/foo\",\n")]),_c('span',[_v("},\n")]),_c('span',[_v("{\n")]),_c('span',[_v("    \"person_id\": \"53\",\n")]),_c('span',[_v("    \"name\": \"bar\",\n")]),_c('span',[_v("    \"link\": \"https://social.com/bar\",\n")]),_c('span',[_v("},\n")]),_c('span',[_v("{\n")]),_c('span',[_v("    \"person_id\": \"1234\",\n")]),_c('span',[_v("    \"name\": \"baz\",\n")]),_c('span',[_v("    \"link\": \"https://social.com/baz\",\n")]),_c('span',[_v("},\n")])])]),_c('p',[_v("For internal communications, we could use "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#remote-procedure-call-rpc"}},[_v("Remote Procedure Calls")]),_v(".")]),_v(" "),_c('h2',{attrs:{"id":"step-4-scale-the-design"}},[_c('span',{staticClass:"anchor",attrs:{"id":"step-4-scale-the-design"}}),_v("Step 4: Scale the design"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#step-4-scale-the-design","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("Identify and address bottlenecks, given the constraints.")])]),_v(" "),_c('p',[_c('a',{attrs:{"href":"http://i.imgur.com/cdCv5g7.png","target":"_self"}},[_c('img',{staticClass:"img-fluid",attrs:{"src":"http://i.imgur.com/cdCv5g7.png","alt":""}})])]),_v(" "),_c('p',[_c('strong',[_v("Important: Do not simply jump right into the final design from the initial design!")])]),_v(" "),_c('p',[_v("State you would 1) "),_c('strong',[_v("Benchmark/Load Test")]),_v(", 2) "),_c('strong',[_v("Profile")]),_v(" for bottlenecks 3) address bottlenecks while evaluating alternatives and trade-offs, and 4) repeat.  See "),_c('a',{attrs:{"href":"/solutions/system_design/scaling_aws/README.html"}},[_v("Design a system that scales to millions of users on AWS")]),_v(" as a sample on how to iteratively scale the initial design.")]),_v(" "),_c('p',[_v("It's important to discuss what bottlenecks you might encounter with the initial design and how you might address each of them.  For example, what issues are addressed by adding a "),_c('strong',[_v("Load Balancer")]),_v(" with multiple "),_c('strong',[_v("Web Servers")]),_v("?  "),_c('strong',[_v("CDN")]),_v("?  "),_c('strong',[_v("Master-Slave Replicas")]),_v("?  What are the alternatives and "),_c('strong',[_v("Trade-Offs")]),_v(" for each?")]),_v(" "),_c('p',[_v("We'll introduce some components to complete the design and to address scalability issues.  Internal load balancers are not shown to reduce clutter.")]),_v(" "),_c('p',[_c('em',[_v("To avoid repeating discussions")]),_v(", refer to the following "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#index-of-system-design-topics"}},[_v("system design topics")]),_v(" for main talking points, tradeoffs, and alternatives:")]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#domain-name-system"}},[_v("DNS")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#load-balancer"}},[_v("Load balancer")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#horizontal-scaling"}},[_v("Horizontal scaling")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#reverse-proxy-web-server"}},[_v("Web server (reverse proxy)")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#application-layer"}},[_v("API server (application layer)")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#cache"}},[_v("Cache")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#consistency-patterns"}},[_v("Consistency patterns")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#availability-patterns"}},[_v("Availability patterns")])])]),_v(" "),_c('p',[_v("To address the constraint of 400 "),_c('em',[_v("average")]),_v(" read requests per second (higher at peak), person data can be served from a "),_c('strong',[_v("Memory Cache")]),_v(" such as Redis or Memcached to reduce response times and to reduce traffic to downstream services.  This could be especially useful for people who do multiple searches in succession and for people who are well-connected.  Reading 1 MB sequentially from memory takes about 250 microseconds, while reading from SSD takes 4x and from disk takes 80x longer."),_c('sup',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#latency-numbers-every-programmer-should-know"}},[_v("1")])])]),_v(" "),_c('p',[_v("Below are further optimizations:")]),_v(" "),_c('ul',[_c('li',[_v("Store complete or partial BFS traversals to speed up subsequent lookups in the "),_c('strong',[_v("Memory Cache")])]),_v(" "),_c('li',[_v("Batch compute offline then store complete or partial BFS traversals to speed up subsequent lookups in a "),_c('strong',[_v("NoSQL Database")])]),_v(" "),_c('li',[_v("Reduce machine jumps by batching together friend lookups hosted on the same "),_c('strong',[_v("Person Server")]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#sharding"}},[_v("Shard")]),_v(" "),_c('strong',[_v("Person Servers")]),_v(" by location to further improve this, as friends generally live closer to each other")])])]),_v(" "),_c('li',[_v("Do two BFS searches at the same time, one starting from the source, and one from the destination, then merge the two paths")]),_v(" "),_c('li',[_v("Start the BFS search from people with large numbers of friends, as they are more likely to reduce the number of "),_c('a',{attrs:{"href":"https://en.wikipedia.org/wiki/Six_degrees_of_separation"}},[_v("degrees of separation")]),_v(" between the current user and the search target")]),_v(" "),_c('li',[_v("Set a limit based on time or number of hops before asking the user if they want to continue searching, as searching could take a considerable amount of time in some cases")]),_v(" "),_c('li',[_v("Use a "),_c('strong',[_v("Graph Database")]),_v(" such as "),_c('a',{attrs:{"href":"https://neo4j.com/"}},[_v("Neo4j")]),_v(" or a graph-specific query language such as "),_c('a',{attrs:{"href":"http://graphql.org/"}},[_v("GraphQL")]),_v(" (if there were no constraint preventing the use of "),_c('strong',[_v("Graph Databases")]),_v(")")])]),_v(" "),_c('h2',{attrs:{"id":"additional-talking-points"}},[_c('span',{staticClass:"anchor",attrs:{"id":"additional-talking-points"}}),_v("Additional talking points"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#additional-talking-points","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("Additional topics to dive into, depending on the problem scope and time remaining.")])]),_v(" "),_c('h3',{attrs:{"id":"sql-scaling-patterns"}},[_c('span',{staticClass:"anchor",attrs:{"id":"sql-scaling-patterns"}}),_v("SQL scaling patterns"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#sql-scaling-patterns","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#master-slave-replication"}},[_v("Read replicas")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#federation"}},[_v("Federation")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#sharding"}},[_v("Sharding")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#denormalization"}},[_v("Denormalization")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#sql-tuning"}},[_v("SQL Tuning")])])]),_v(" "),_c('h4',{attrs:{"id":"nosql"}},[_c('span',{staticClass:"anchor",attrs:{"id":"nosql"}}),_v("NoSQL"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#nosql","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#key-value-store"}},[_v("Key-value store")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#document-store"}},[_v("Document store")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#wide-column-store"}},[_v("Wide column store")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#graph-database"}},[_v("Graph database")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#sql-or-nosql"}},[_v("SQL vs NoSQL")])])]),_v(" "),_c('h3',{attrs:{"id":"caching"}},[_c('span',{staticClass:"anchor",attrs:{"id":"caching"}}),_v("Caching"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#caching","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("Where to cache\n"),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#client-caching"}},[_v("Client caching")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#cdn-caching"}},[_v("CDN caching")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#web-server-caching"}},[_v("Web server caching")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#database-caching"}},[_v("Database caching")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#application-caching"}},[_v("Application caching")])])])]),_v(" "),_c('li',[_v("What to cache\n"),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#caching-at-the-database-query-level"}},[_v("Caching at the database query level")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#caching-at-the-object-level"}},[_v("Caching at the object level")])])])]),_v(" "),_c('li',[_v("When to update the cache\n"),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#cache-aside"}},[_v("Cache-aside")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#write-through"}},[_v("Write-through")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#write-behind-write-back"}},[_v("Write-behind (write-back)")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#refresh-ahead"}},[_v("Refresh ahead")])])])])]),_v(" "),_c('h3',{attrs:{"id":"asynchronism-and-microservices"}},[_c('span',{staticClass:"anchor",attrs:{"id":"asynchronism-and-microservices"}}),_v("Asynchronism and microservices"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#asynchronism-and-microservices","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#message-queues"}},[_v("Message queues")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#task-queues"}},[_v("Task queues")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#back-pressure"}},[_v("Back pressure")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#microservices"}},[_v("Microservices")])])]),_v(" "),_c('h3',{attrs:{"id":"communications"}},[_c('span',{staticClass:"anchor",attrs:{"id":"communications"}}),_v("Communications"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#communications","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("Discuss tradeoffs:\n"),_c('ul',[_c('li',[_v("External communication with clients - "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#representational-state-transfer-rest"}},[_v("HTTP APIs following REST")])]),_v(" "),_c('li',[_v("Internal communications - "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#remote-procedure-call-rpc"}},[_v("RPC")])])])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#service-discovery"}},[_v("Service discovery")])])]),_v(" "),_c('h3',{attrs:{"id":"security"}},[_c('span',{staticClass:"anchor",attrs:{"id":"security"}}),_v("Security"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#security","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("Refer to the "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#security"}},[_v("security section")]),_v(".")]),_v(" "),_c('h3',{attrs:{"id":"latency-numbers"}},[_c('span',{staticClass:"anchor",attrs:{"id":"latency-numbers"}}),_v("Latency numbers"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#latency-numbers","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("See "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#latency-numbers-every-programmer-should-know"}},[_v("Latency numbers every programmer should know")]),_v(".")]),_v(" "),_c('h3',{attrs:{"id":"ongoing"}},[_c('span',{staticClass:"anchor",attrs:{"id":"ongoing"}}),_v("Ongoing"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#ongoing","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("Continue benchmarking and monitoring your system to address bottlenecks as they come up")]),_v(" "),_c('li',[_v("Scaling is an iterative process")])]),_v(" "),_c('i',{staticClass:"fa fa-arrow-circle-up fa-lg d-print-none",attrs:{"id":"scroll-top-button","onclick":"handleScrollTop()","aria-hidden":"true"}})])}
},function anonymous(
) {
with(this){return _c('footer',[_c('div',{staticClass:"text-center"},[_c('small',[_v("[Generated by "),_c('a',{attrs:{"href":"https://markbind.org/"}},[_v("MarkBind 3.1.1")]),_v("]")])])])}
}];
  