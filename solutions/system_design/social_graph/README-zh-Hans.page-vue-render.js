
    var pageVueRenderFn = function anonymous(
) {
with(this){return _c('div',{attrs:{"id":"app"}},[_c('header',{attrs:{"fixed":""}},[_c('navbar',{attrs:{"type":"dark"},scopedSlots:_u([{key:"brand",fn:function(){return [_c('a',{staticClass:"navbar-brand",attrs:{"href":"/index.html","title":"Home"}},[_v("System Design Primer")])]},proxy:true},{key:"right",fn:function(){return [_c('li',[_c('form',{staticClass:"navbar-form"},[_c('searchbar',{attrs:{"data":searchData,"placeholder":"Search","on-hit":searchCallback,"menu-align-right":""}})],1)])]},proxy:true}])},[_v(" "),_c('dropdown',{staticClass:"nav-link",scopedSlots:_u([{key:"header",fn:function(){return [_v("Solutions")]},proxy:true}])},[_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/mint/readme.html"}},[_v("mint")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/pastebin/readme.html"}},[_v("pastebin")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/query_cache/readme.html"}},[_v("query_cache")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/sales_rank/readme.html"}},[_v("sales_rank")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/scaling_aws/readme.html"}},[_v("scaling_aws")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/social_graph/readme.html"}},[_v("social_graph")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/twitter/readme.html"}},[_v("twitter")])]),_v(" "),_c('li',[_c('a',{staticClass:"dropdown-item",attrs:{"href":"/solutions/system_design/web_crawler/readme.html"}},[_v("web_crawler")])])])],1)],1),_v(" "),_c('div',{attrs:{"id":"flex-body"}},[_c('overlay-source',{staticClass:"fixed-header-padding",attrs:{"id":"site-nav","tag-name":"nav","to":"site-nav"}},[_c('div',{staticClass:"site-nav-top"},[_c('div',{staticClass:"font-weight-bold mb-2",staticStyle:{"font-size":"1.25rem"}},[_v("Topics")])]),_v(" "),_c('div',{staticClass:"nav-component slim-scroll"},[_c('site-nav',[_c('overlay-source',{staticClass:"site-nav-list site-nav-list-root",attrs:{"tag-name":"ul","to":"mb-site-nav"}},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_v("Preface\n\n"),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Motivation.html"}},[_v("Motivation")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Ankiflashcards.html"}},[_v("Anki flashcards")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Indexof-system-design-topics.html"}},[_v("Index")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Studyguide.html"}},[_v("Study Guide")])])])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_v("Interview Questions\n\n"),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Howto-approach-a-system-design-interview-question.html"}},[_v("How to approach a system design interview question")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Object-orienteddesign-interview-questions-with-solutions.html"}},[_v("OOP interview questions")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Systemdesign-interview-questions-with-solutions.html"}},[_v("System design interview questions")])])])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Systemdesign-topics-start-here.html"}},[_v("System design topics")]),_v(" "),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Performancevs-scalability.html"}},[_v("Performance vs scalability")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Latencyvs-throughput.html"}},[_v("Latency vs throughput")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Availabilityvs-consistency.html"}},[_v("Availability vs consistency")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Consistencypatterns.html"}},[_v("Consistency patterns")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Availabilitypatterns.html"}},[_v("Availability patterns")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Domainname-system.html"}},[_v("Domain name system")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Contentdelivery-network.html"}},[_v("Content delivery network")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Loadbalancer.html"}},[_v("Load balancer")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Reverseproxy-(web-server).html"}},[_v("Reverse proxy (web server)")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Applicationlayer.html"}},[_v("Application layer")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Database.html"}},[_v("Database")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Cache.html"}},[_v("Cache")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Asynchronism.html"}},[_v("Asynchronism")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Communication.html"}},[_v("Communication")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Security.html"}},[_v("Security")])])])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-0",attrs:{"onclick":"handleSiteNavClick(this)"}},[_v("Misc\n\n"),_c('i',{staticClass:"site-nav-dropdown-btn-icon",attrs:{"onclick":"handleSiteNavClick(this.parentNode, false); event.stopPropagation();"}},[_c('span',{staticClass:"glyphicon glyphicon-menu-down",attrs:{"aria-hidden":"true"}})])]),_c('ul',{staticClass:"site-nav-dropdown-container site-nav-list"},[_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Appendix.html"}},[_v("Appendix")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Underdevelopment.html"}},[_v("Under development")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Credits.html"}},[_v("Credits")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Contactinfo.html"}},[_v("Contact info")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/Contributing.html"}},[_v("Contributing")])])]),_v(" "),_c('li',[_c('div',{staticClass:"site-nav-default-list-item site-nav-list-item-1",attrs:{"onclick":"handleSiteNavClick(this)"}},[_c('a',{attrs:{"href":"/contents/License.html"}},[_v("License")])])])])])])],1)],1)]),_v(" "),_m(0),_v(" "),_c('overlay-source',{staticClass:"fixed-header-padding",attrs:{"id":"page-nav","tag-name":"nav","to":"page-nav"}},[_c('div',{staticClass:"nav-component slim-scroll"})])],1),_v(" "),_m(1)])}
};
    var pageVueStaticRenderFns = [function anonymous(
) {
with(this){return _c('div',{staticClass:"fixed-header-padding",attrs:{"id":"content-wrapper"}},[_c('h1',{attrs:{"id":""}},[_v("为社交网络设计数据结构")]),_v(" "),_c('p',[_c('strong',[_v("注释：为了避免重复，这篇文章的链接直接关联到 "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#index-of-system-design-topics"}},[_v("系统设计主题")]),_v(" 的相关章节。为一讨论要点、折中方案和可选方案做参考。")])]),_v(" "),_c('h2',{attrs:{"id":"1"}},[_c('span',{staticClass:"anchor",attrs:{"id":"1"}}),_v("第 1 步：用例和约束概要"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#1","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("收集需求并调查问题。\n通过提问清晰用例和约束。\n讨论假设。")])]),_v(" "),_c('p',[_v("如果没有面试官提出明确的问题，我们将自己定义一些用例和约束条件。")]),_v(" "),_c('h3',{attrs:{"id":"-2"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-2"}}),_v("用例"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-2","onclick":"event.stopPropagation()"}})]),_v(" "),_c('h4',{attrs:{"id":"-3"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-3"}}),_v("我们就处理以下用例审视这一问题"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-3","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('strong',[_v("用户")]),_v(" 寻找某人并显示与被寻人之间的最短路径")]),_v(" "),_c('li',[_c('strong',[_v("服务")]),_v(" 高可用")])]),_v(" "),_c('h3',{attrs:{"id":"-4"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-4"}}),_v("约束和假设"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-4","onclick":"event.stopPropagation()"}})]),_v(" "),_c('h4',{attrs:{"id":"-5"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-5"}}),_v("状态假设"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-5","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("流量分布不均\n"),_c('ul',[_c('li',[_v("某些搜索比别的更热门，同时某些搜索仅执行一次")])])]),_v(" "),_c('li',[_v("图数据不适用单一机器")]),_v(" "),_c('li',[_v("图的边没有权重")]),_v(" "),_c('li',[_v("1 千万用户")]),_v(" "),_c('li',[_v("每个用户平均有 50 个朋友")]),_v(" "),_c('li',[_v("每月 10 亿次朋友搜索")])]),_v(" "),_c('p',[_v("训练使用更传统的系统 - 别用图特有的解决方案例如 "),_c('a',{attrs:{"href":"http://graphql.org/"}},[_v("GraphQL")]),_v(" 或图数据库如 "),_c('a',{attrs:{"href":"https://neo4j.com/"}},[_v("Neo4j")]),_v("。")]),_v(" "),_c('h4',{attrs:{"id":"-6"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-6"}}),_v("计算使用"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-6","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_c('strong',[_v("向你的面试官厘清你是否应该做粗略的使用计算")])]),_v(" "),_c('ul',[_c('li',[_v("50 亿朋友关系\n"),_c('ul',[_c('li',[_v("1 亿用户 * 平均每人 50 个朋友")])])]),_v(" "),_c('li',[_v("每秒 400 次搜索请求")])]),_v(" "),_c('p',[_v("便捷的转换指南：")]),_v(" "),_c('ul',[_c('li',[_v("每月 250 万秒")]),_v(" "),_c('li',[_v("每秒 1 个请求 = 每月 250 万次请求")]),_v(" "),_c('li',[_v("每秒 40 个请求 = 每月 1 亿次请求")]),_v(" "),_c('li',[_v("每秒 400 个请求 = 每月 10 亿次请求")])]),_v(" "),_c('h2',{attrs:{"id":"2"}},[_c('span',{staticClass:"anchor",attrs:{"id":"2"}}),_v("第 2 步：创建高级设计方案"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#2","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("用所有重要组件概述高水平设计")])]),_v(" "),_c('p',[_c('a',{attrs:{"href":"http://i.imgur.com/wxXyq2J.png","target":"_self"}},[_c('img',{staticClass:"img-fluid",attrs:{"src":"http://i.imgur.com/wxXyq2J.png","alt":""}})])]),_v(" "),_c('h2',{attrs:{"id":"3"}},[_c('span',{staticClass:"anchor",attrs:{"id":"3"}}),_v("第 3 步：设计核心组件"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#3","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("深入每个核心组件的细节。")])]),_v(" "),_c('h3',{attrs:{"id":"-7"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-7"}}),_v("用例： 用户搜索某人并查看到被搜人的最短路径"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-7","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_c('strong',[_v("和你的面试官说清你期望的代码量")])]),_v(" "),_c('p',[_v("没有百万用户（点）的和十亿朋友关系（边）的限制，我们能够用一般 BFS 方法解决无权重最短路径任务：")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("Graph")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("Graph")]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("shortest_path")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, source, dest")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" source "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("or")]),_v(" dest "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" source "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" dest:\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" [source.key]\n")]),_c('span',[_v("        prev_node_keys = self._shortest_path(source, dest)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" prev_node_keys "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("else")]),_v(":\n")]),_c('span',[_v("            path_ids = [dest.key]\n")]),_c('span',[_v("            prev_node_key = prev_node_keys[dest.key]\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("while")]),_v(" prev_node_key "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("not")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("                path_ids.append(prev_node_key)\n")]),_c('span',[_v("                prev_node_key = prev_node_keys[prev_node_key]\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" path_ids[::-"),_c('span',{pre:true,attrs:{"class":"hljs-number"}},[_v("1")]),_v("]\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("_shortest_path")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, source, dest")]),_v("):")]),_v("\n")]),_c('span',[_v("        queue = deque()\n")]),_c('span',[_v("        queue.append(source)\n")]),_c('span',[_v("        prev_node_keys = {source.key: "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("}\n")]),_c('span',[_v("        source.visit_state = State.visited\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("while")]),_v(" queue:\n")]),_c('span',[_v("            node = queue.popleft()\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" node "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" dest:\n")]),_c('span',[_v("                "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" prev_node_keys\n")]),_c('span',[_v("            prev_node = node\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("for")]),_v(" adj_node "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("in")]),_v(" node.adj_nodes.values():\n")]),_c('span',[_v("                "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" adj_node.visit_state == State.unvisited:\n")]),_c('span',[_v("                    queue.append(adj_node)\n")]),_c('span',[_v("                    prev_node_keys[adj_node.key] = prev_node.key\n")]),_c('span',[_v("                    adj_node.visit_state = State.visited\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")])])]),_c('p',[_v("我们不能在同一台机器上满足所有用户，我们需要通过 "),_c('strong',[_v("人员服务器")]),_v(" "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#sharding"}},[_v("拆分")]),_v(" 用户并且通过 "),_c('strong',[_v("查询服务")]),_v(" 访问。")]),_v(" "),_c('ul',[_c('li',[_c('strong',[_v("客户端")]),_v(" 向 "),_c('strong',[_v("服务器")]),_v(" 发送请求，"),_c('strong',[_v("服务器")]),_v(" 作为 "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#reverse-proxy-web-server"}},[_v("反向代理")])]),_v(" "),_c('li',[_c('strong',[_v("搜索 API")]),_v(" 服务器向 "),_c('strong',[_v("用户图服务")]),_v(" 转发请求")]),_v(" "),_c('li',[_c('strong',[_v("用户图服务")]),_v(" 有以下功能：\n"),_c('ul',[_c('li',[_v("使用 "),_c('strong',[_v("查询服务")]),_v(" 找到当前用户信息存储的 "),_c('strong',[_v("人员服务器")])]),_v(" "),_c('li',[_v("找到适当的 "),_c('strong',[_v("人员服务器")]),_v(" 检索当前用户的 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("friend_ids")]),_v(" 列表")]),_v(" "),_c('li',[_v("把当前用户作为 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("source")]),_v(" 运行 BFS 搜索算法同时 当前用户的 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("friend_ids")]),_v(" 作为每个 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("adjacent_node")]),_v(" 的 ids")]),_v(" "),_c('li',[_v("给定 id 获取 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("adjacent_node")]),_v(":\n"),_c('ul',[_c('li',[_c('strong',[_v("用户图服务")]),_v(" 将 "),_c('strong',[_v("再次")]),_v(" 和 "),_c('strong',[_v("查询服务")]),_v(" 通讯，最后判断出和给定 id 相匹配的存储 "),_c('code',{pre:true,attrs:{"class":"hljs inline no-lang"}},[_v("adjacent_node")]),_v(" 的 "),_c('strong',[_v("人员服务器")]),_v("（有待优化）")])])])])])]),_v(" "),_c('p',[_c('strong',[_v("和你的面试官说清你应该写的代码量")])]),_v(" "),_c('p',[_c('strong',[_v("注释")]),_v("：简易版错误处理执行如下。询问你是否需要编写适当的错误处理方法。")]),_v(" "),_c('p',[_c('strong',[_v("查询服务")]),_v(" 实现：")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("LookupService")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self")]),_v("):")]),_v("\n")]),_c('span',[_v("        self.lookup = self._init_lookup()  "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# key: person_id, value: person_server")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("_init_lookup")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self")]),_v("):")]),_v("\n")]),_c('span',[_v("        ...\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("lookup_person_server")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, person_id")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" self.lookup[person_id]\n")])])]),_c('p',[_c('strong',[_v("人员服务器")]),_v(" 实现：")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("PersonServer")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self")]),_v("):")]),_v("\n")]),_c('span',[_v("        self.people = {}  "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# key: person_id, value: person")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("add_person")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, person")]),_v("):")]),_v("\n")]),_c('span',[_v("        ...\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("people")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, ids")]),_v("):")]),_v("\n")]),_c('span',[_v("        results = []\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("for")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("id")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("in")]),_v(" ids:\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("id")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("in")]),_v(" self.people:\n")]),_c('span',[_v("                results.append(self.people["),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("id")]),_v("])\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" results\n")])])]),_c('p',[_c('strong',[_v("用户")]),_v(" 实现：")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("Person")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, "),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("id")]),_v(", name, friend_ids")]),_v("):")]),_v("\n")]),_c('span',[_v("        self."),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("id")]),_v(" = "),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("id")]),_v("\n")]),_c('span',[_v("        self.name = name\n")]),_c('span',[_v("        self.friend_ids = friend_ids\n")])])]),_c('p',[_c('strong',[_v("用户图服务")]),_v(" 实现：")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs python"}},[_c('span',[_c('span',{pre:true,attrs:{"class":"hljs-class"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("class")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("UserGraphService")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("object")])]),_v("):")]),_v("\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("__init__")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, lookup_service")]),_v("):")]),_v("\n")]),_c('span',[_v("        self.lookup_service = lookup_service\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("person")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, person_id")]),_v("):")]),_v("\n")]),_c('span',[_v("        person_server = self.lookup_service.lookup_person_server(person_id)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" person_server.people([person_id])\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("shortest_path")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, source_key, dest_key")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" source_key "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("or")]),_v(" dest_key "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" source_key "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" dest_key:\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" [source_key]\n")]),_c('span',[_v("        prev_node_keys = self._shortest_path(source_key, dest_key)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" prev_node_keys "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("else")]),_v(":\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# Iterate through the path_ids backwards, starting at dest_key")]),_v("\n")]),_c('span',[_v("            path_ids = [dest_key]\n")]),_c('span',[_v("            prev_node_key = prev_node_keys[dest_key]\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("while")]),_v(" prev_node_key "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("not")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v(":\n")]),_c('span',[_v("                path_ids.append(prev_node_key)\n")]),_c('span',[_v("                prev_node_key = prev_node_keys[prev_node_key]\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# Reverse the list since we iterated backwards")]),_v("\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" path_ids[::-"),_c('span',{pre:true,attrs:{"class":"hljs-number"}},[_v("1")]),_v("]\n")]),_c('span',[_v("\n")]),_c('span',[_v("    "),_c('span',{pre:true,attrs:{"class":"hljs-function"}},[_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("def")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-title"}},[_v("_shortest_path")]),_v("("),_c('span',{pre:true,attrs:{"class":"hljs-params"}},[_v("self, source_key, dest_key, path")]),_v("):")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# Use the id to get the Person")]),_v("\n")]),_c('span',[_v("        source = self.person(source_key)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# Update our bfs queue")]),_v("\n")]),_c('span',[_v("        queue = deque()\n")]),_c('span',[_v("        queue.append(source)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# prev_node_keys keeps track of each hop from")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# the source_key to the dest_key")]),_v("\n")]),_c('span',[_v("        prev_node_keys = {source_key: "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("}\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# We'll use visited_ids to keep track of which nodes we've")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# visited, which can be different from a typical bfs where")]),_v("\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-comment"}},[_v("# this can be stored in the node itself")]),_v("\n")]),_c('span',[_v("        visited_ids = "),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("set")]),_v("()\n")]),_c('span',[_v("        visited_ids.add(source."),_c('span',{pre:true,attrs:{"class":"hljs-built_in"}},[_v("id")]),_v(")\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("while")]),_v(" queue:\n")]),_c('span',[_v("            node = queue.popleft()\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" node.key "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("is")]),_v(" dest_key:\n")]),_c('span',[_v("                "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" prev_node_keys\n")]),_c('span',[_v("            prev_node = node\n")]),_c('span',[_v("            "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("for")]),_v(" friend_id "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("in")]),_v(" node.friend_ids:\n")]),_c('span',[_v("                "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("if")]),_v(" friend_id "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("not")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("in")]),_v(" visited_ids:\n")]),_c('span',[_v("                    friend_node = self.person(friend_id)\n")]),_c('span',[_v("                    queue.append(friend_node)\n")]),_c('span',[_v("                    prev_node_keys[friend_id] = prev_node.key\n")]),_c('span',[_v("                    visited_ids.add(friend_id)\n")]),_c('span',[_v("        "),_c('span',{pre:true,attrs:{"class":"hljs-keyword"}},[_v("return")]),_v(" "),_c('span',{pre:true,attrs:{"class":"hljs-literal"}},[_v("None")]),_v("\n")])])]),_c('p',[_v("我们用的是公共的 "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#representational-state-transfer-rest"}},[_c('strong',[_v("REST API")])]),_v("：")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs"}},[_c('span',[_v("$ curl https://social.com/api/v1/friend_search?person_id=1234\n")])])]),_c('p',[_v("响应：")]),_v(" "),_c('pre',[_c('code',{pre:true,attrs:{"class":"hljs"}},[_c('span',[_v("{\n")]),_c('span',[_v("    \"person_id\": \"100\",\n")]),_c('span',[_v("    \"name\": \"foo\",\n")]),_c('span',[_v("    \"link\": \"https://social.com/foo\",\n")]),_c('span',[_v("},\n")]),_c('span',[_v("{\n")]),_c('span',[_v("    \"person_id\": \"53\",\n")]),_c('span',[_v("    \"name\": \"bar\",\n")]),_c('span',[_v("    \"link\": \"https://social.com/bar\",\n")]),_c('span',[_v("},\n")]),_c('span',[_v("{\n")]),_c('span',[_v("    \"person_id\": \"1234\",\n")]),_c('span',[_v("    \"name\": \"baz\",\n")]),_c('span',[_v("    \"link\": \"https://social.com/baz\",\n")]),_c('span',[_v("},\n")])])]),_c('p',[_v("内部通信使用 "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#remote-procedure-call-rpc"}},[_v("远端过程调用")]),_v("。")]),_v(" "),_c('h2',{attrs:{"id":"4"}},[_c('span',{staticClass:"anchor",attrs:{"id":"4"}}),_v("第 4 步：扩展设计"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#4","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("在给定约束条件下，定义和确认瓶颈。")])]),_v(" "),_c('p',[_c('a',{attrs:{"href":"http://i.imgur.com/cdCv5g7.png","target":"_self"}},[_c('img',{staticClass:"img-fluid",attrs:{"src":"http://i.imgur.com/cdCv5g7.png","alt":""}})])]),_v(" "),_c('p',[_c('strong',[_v("重要：别简化从最初设计到最终设计的过程！")])]),_v(" "),_c('p',[_v("你将要做的是：1) "),_c('strong',[_v("基准/负载 测试")]),_v("， 2) 瓶颈 "),_c('strong',[_v("概述")]),_v("， 3) 当评估可选和折中方案时定位瓶颈，4) 重复。以 "),_c('a',{attrs:{"href":"/solutions/system_design/scaling_aws/README.html"}},[_v("在 AWS 上设计支持百万级到千万级用户的系统")]),_v(" 为参考迭代地扩展最初设计。")]),_v(" "),_c('p',[_v("讨论最初设计可能遇到的瓶颈和处理方法十分重要。例如，什么问题可以通过添加多台 "),_c('strong',[_v("Web 服务器")]),_v(" 作为 "),_c('strong',[_v("负载均衡")]),_v(" 解决？"),_c('strong',[_v("CDN")]),_v("？"),_c('strong',[_v("主从副本")]),_v("？每个问题都有哪些替代和 "),_c('strong',[_v("折中")]),_v(" 方案？")]),_v(" "),_c('p',[_v("我们即将介绍一些组件来完成设计和解决扩展性问题。内部负载均衡不显示以减少混乱。")]),_v(" "),_c('p',[_c('strong',[_v("避免重复讨论")]),_v("，以下网址链接到 "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#index-of-system-design-topics"}},[_v("系统设计主题")]),_v(" 相关的主流方案、折中方案和替代方案。")]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#domain-name-system"}},[_v("DNS")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#load-balancer"}},[_v("负载均衡")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#horizontal-scaling"}},[_v("横向扩展")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#reverse-proxy-web-server"}},[_v("Web 服务器（反向代理）")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#application-layer"}},[_v("API 服务器（应用层）")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#cache"}},[_v("缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#consistency-patterns"}},[_v("一致性模式")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#availability-patterns"}},[_v("可用性模式")])])]),_v(" "),_c('p',[_v("解决 "),_c('strong',[_v("平均")]),_v(" 每秒 400 次请求的限制（峰值），人员数据可以存在例如 Redis 或 Memcached 这样的 "),_c('strong',[_v("内存")]),_v(" 中以减少响应次数和下游流量通信服务。这尤其在用户执行多次连续查询和查询哪些广泛连接的人时十分有用。从内存中读取 1MB 数据大约要 250 微秒，从 SSD 中读取同样大小的数据时间要长 4 倍，从硬盘要长 80 倍。"),_c('sup',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#latency-numbers-every-programmer-should-know"}},[_v("1")])])]),_v(" "),_c('p',[_v("以下是进一步优化方案：")]),_v(" "),_c('ul',[_c('li',[_v("在 "),_c('strong',[_v("内存")]),_v(" 中存储完整的或部分的BFS遍历加快后续查找")]),_v(" "),_c('li',[_v("在 "),_c('strong',[_v("NoSQL 数据库")]),_v(" 中批量离线计算并存储完整的或部分的BFS遍历加快后续查找")]),_v(" "),_c('li',[_v("在同一台 "),_c('strong',[_v("人员服务器")]),_v(" 上托管批处理同一批朋友查找减少机器跳转\n"),_c('ul',[_c('li',[_v("通过地理位置 "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#sharding"}},[_v("拆分")]),_v(" "),_c('strong',[_v("人员服务器")]),_v(" 来进一步优化，因为朋友通常住得都比较近")])])]),_v(" "),_c('li',[_v("同时进行两个 BFS 查找，一个从 source 开始，一个从 destination 开始，然后合并两个路径")]),_v(" "),_c('li',[_v("从有庞大朋友圈的人开始找起，这样更有可能减小当前用户和搜索目标之间的 "),_c('a',{attrs:{"href":"https://en.wikipedia.org/wiki/Six_degrees_of_separation"}},[_v("离散度数")])]),_v(" "),_c('li',[_v("在询问用户是否继续查询之前设置基于时间或跳跃数阈值，当在某些案例中搜索耗费时间过长时。")]),_v(" "),_c('li',[_v("使用类似 "),_c('a',{attrs:{"href":"https://neo4j.com/"}},[_v("Neo4j")]),_v(" 的 "),_c('strong',[_v("图数据库")]),_v(" 或图特定查询语法，例如 "),_c('a',{attrs:{"href":"http://graphql.org/"}},[_v("GraphQL")]),_v("（如果没有禁止使用 "),_c('strong',[_v("图数据库")]),_v(" 的限制的话）")])]),_v(" "),_c('h2',{attrs:{"id":"-8"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-8"}}),_v("额外的话题"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-8","onclick":"event.stopPropagation()"}})]),_v(" "),_c('blockquote',[_c('p',[_v("根据问题的范围和剩余时间，还需要深入讨论其他问题。")])]),_v(" "),_c('h3',{attrs:{"id":"sql"}},[_c('span',{staticClass:"anchor",attrs:{"id":"sql"}}),_v("SQL 扩展模式"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#sql","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#master-slave-replication"}},[_v("读取副本")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#federation"}},[_v("集合")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#sharding"}},[_v("分区")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#denormalization"}},[_v("反规范化")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#sql-tuning"}},[_v("SQL 调优")])])]),_v(" "),_c('h4',{attrs:{"id":"nosql"}},[_c('span',{staticClass:"anchor",attrs:{"id":"nosql"}}),_v("NoSQL"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#nosql","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#key-value-store"}},[_v("键值存储")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#document-store"}},[_v("文档存储")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#wide-column-store"}},[_v("宽表存储")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#graph-database"}},[_v("图数据库")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#sql-or-nosql"}},[_v("SQL vs NoSQL")])])]),_v(" "),_c('h3',{attrs:{"id":"-9"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-9"}}),_v("缓存"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-9","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("缓存到哪里\n"),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#client-caching"}},[_v("客户端缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#cdn-caching"}},[_v("CDN 缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#web-server-caching"}},[_v("Web 服务缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#database-caching"}},[_v("数据库缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#application-caching"}},[_v("应用缓存")])])])]),_v(" "),_c('li',[_v("缓存什么\n"),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#caching-at-the-database-query-level"}},[_v("数据库请求层缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#caching-at-the-object-level"}},[_v("对象层缓存")])])])]),_v(" "),_c('li',[_v("何时更新缓存\n"),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#cache-aside"}},[_v("预留缓存")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#write-through"}},[_v("完全写入")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#write-behind-write-back"}},[_v("延迟写 (写回)")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#refresh-ahead"}},[_v("事先更新")])])])])]),_v(" "),_c('h3',{attrs:{"id":"-10"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-10"}}),_v("异步性和微服务"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-10","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#message-queues"}},[_v("消息队列")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#task-queues"}},[_v("任务队列")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#back-pressure"}},[_v("回退压力")])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#microservices"}},[_v("微服务")])])]),_v(" "),_c('h3',{attrs:{"id":"-11"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-11"}}),_v("沟通"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-11","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("关于折中方案的讨论:\n"),_c('ul',[_c('li',[_v("客户端的外部通讯 - "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#representational-state-transfer-rest"}},[_v("遵循 REST 的 HTTP APIs")])]),_v(" "),_c('li',[_v("内部通讯 - "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#remote-procedure-call-rpc"}},[_v("RPC")])])])]),_v(" "),_c('li',[_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#service-discovery"}},[_v("服务探索")])])]),_v(" "),_c('h3',{attrs:{"id":"-12"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-12"}}),_v("安全性"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-12","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("参考 "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#security"}},[_v("安全章节")])]),_v(" "),_c('h3',{attrs:{"id":"-13"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-13"}}),_v("延迟数字指标"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-13","onclick":"event.stopPropagation()"}})]),_v(" "),_c('p',[_v("查阅 "),_c('a',{attrs:{"href":"https://github.com/donnemartin/system-design-primer#latency-numbers-every-programmer-should-know"}},[_v("每个程序员必懂的延迟数字")])]),_v(" "),_c('h3',{attrs:{"id":"-14"}},[_c('span',{staticClass:"anchor",attrs:{"id":"-14"}}),_v("正在进行"),_c('a',{staticClass:"fa fa-anchor",attrs:{"href":"#-14","onclick":"event.stopPropagation()"}})]),_v(" "),_c('ul',[_c('li',[_v("继续基准测试并监控你的系统以解决出现的瓶颈问题")]),_v(" "),_c('li',[_v("扩展是一个迭代的过程")])]),_v(" "),_c('i',{staticClass:"fa fa-arrow-circle-up fa-lg d-print-none",attrs:{"id":"scroll-top-button","onclick":"handleScrollTop()","aria-hidden":"true"}})])}
},function anonymous(
) {
with(this){return _c('footer',[_c('div',{staticClass:"text-center"},[_c('small',[_v("[Generated by "),_c('a',{attrs:{"href":"https://markbind.org/"}},[_v("MarkBind 3.1.1")]),_v("]")])])])}
}];
  